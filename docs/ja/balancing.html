<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Temporal documentation</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/kognise/water.css@latest/dist/light.min.css">
    <script type="application/javascript" src="../playground.js"></script>
    <link rel="stylesheet" type="text/css" href="../prism.css">
    <script>
      Temporal = { ...temporal.Temporal };
      Object.assign(Intl, temporal.Intl);

      // Customize output of Temporal objects for Chrome DevTools
      if (!window.devtoolsFormatters)
        window.devtoolsFormatters = [];
      window.devtoolsFormatters.push({
        header(x) {
          for (const type of [
            Temporal.Instant,
            Temporal.PlainDate,
            Temporal.PlainDateTime,
            Temporal.Duration,
            Temporal.PlainMonthDay,
            Temporal.PlainTime,
            Temporal.PlainYearMonth
          ]) {
            if (x instanceof type) return ['span', {}, `${x[Symbol.toStringTag]} <${x}>`];
          }
          return null;
        },
        hasBody(x) {
          return x instanceof Temporal.Duration;
        },
        body(x) {
          const out = ['ol', { style: 'list-style-type: none;' }];
          for (const prop of [
            'years',
            'months',
            'weeks',
            'days',
            'hours',
            'minutes',
            'seconds',
            'milliseconds',
            'microseconds',
            'nanoseconds'
          ]) {
            if (x[prop] !== 0) out.push([
              'li',
              {},
              ['span', { style: 'color: purple;' }, prop],
              `: `,
              ['span', { style: 'color: blue;' }, x[prop]]
            ]);
          }
          return out;
        }
      });
    </script>
    <style>
      /* https://github.com/kognise/water.css/blob/master/src/variables-light.css */
      :root {
        --background: #efefef;
        --text-muted: #999999;
        --text-bright: #000000;
        --text-width: 900px;
        --variable: #39a33c;
      }
      body {
        font-size: 18px;
        max-width: var(--text-width);
        padding-top: 40px;  /* extra padding for banner */
        line-height: 1.5;
      }
      pre { border-left: 4px solid var(--variable); }
      code {
        padding: 1px 5px 2px 5px;
        line-height: 1.1;
        display: inline-block;
      }
      a code { color: inherit; }
      a code:hover { text-decoration: underline; }
      pre code { line-height: 1.4; }
      pre code[class*="language-"] { font-size: 0.85em; }
      pre[class*="language-"] { padding: 0.5em; }
      h1 { margin-top: 13px; }
      h2 { border-bottom: 2px solid var(--text-muted); margin-top: 2em; }
      h3 {
        border-bottom: 1px solid var(--text-muted);
        color: var(--text-muted);
        font-weight: normal;
      }
      h3 em { font-weight: bold; }
      h3 strong { color: var(--text-bright); }
      :not(h2) + h3 { margin-top: 2em; }
      footer {
        border-top: 1px solid var(--background);
        color: var(--text-muted);
        font-size: 0.8em;
        margin-top: 2em;
        padding-top: 10px;
      }
      .heading-link {
        left: calc((100vw - var(--text-width)) / 2 - 1.5em);
        opacity: 0;
        position: absolute;
        transition: opacity 150ms;
      }
      .heading-link:hover { text-decoration: none; }
      .heading-link::before { content: '¶'; }
      h2:hover .heading-link, h3:hover .heading-link, h4:hover .heading-link, h5:hover .heading-link { opacity: 0.75; }
      .banner {
        background-color: #ffcc7a;
        background-size: 20px 20px;
        box-shadow: 0 5px 0 rgba(0, 0, 0, .1);
        left: 0;
        padding: 0.4em 0;
        position: absolute;
        text-align: center;
        top: 0;
        width: 100%;
      }
    </style>
  </head>
  <body>
    <div class="banner">
      Please visit Temporal documentation on <strong>
        <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Temporal">MDN,</a>
      </strong> the main API reference going forward.
      Or see our <strong><a href="cookbook.html">cookbook</a></strong>.
    </div>
<h1 id="duration-のバランシング"><a class="heading-link" href="#duration-のバランシング"></a>Duration のバランシング</h3><p>Temporal のほとんどのタイプにおいて、各単位（分や秒）には自然な最大値があります。例えば、11 時 87 分という時間はないので、そのような<code>Temporal.PlainTime</code>を作成しようとすると 11:59 にクリッピングされる（&quot;constrain&quot;モード）か、例外が投げられます（&quot;reject&quot;モード）。</p>
<p>しかし<a href="../duration.html"><code>Temporal.Duration</code></a>においては、このような最大値は存在しません。例えば、100 秒の duration がありえます：<code>Temporal.Duration.from({ seconds: 100 })</code>。100 秒は 1 分 40 秒に等しいです。これは、いくつかのケースでは&quot;1 分 40 秒&quot;というように&quot;バランシングする&quot;必要があるかもしれませんが、多くの場合では&quot;100 秒&quot;というように&quot;バランシングしない&quot;ことをおすすめします。</p>
<p>時刻を表すオブジェクト（property bag object）や文字列から<code>Temporal.Duration</code>が作成される場合、バランシングは行われません。</p>
<pre class="language-javascript"><code class="language-javascript">d <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Duration<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">seconds</span><span class="token operator">:</span> <span class="token number">100</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
d<span class="token punctuation">.</span>minutes<span class="token punctuation">;</span> <span class="token comment">// => 0</span>
d<span class="token punctuation">.</span>seconds<span class="token punctuation">;</span> <span class="token comment">// => 100</span>
d <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Duration<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'PT100S'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
d<span class="token punctuation">.</span>minutes<span class="token punctuation">;</span> <span class="token comment">// => 0</span>
d<span class="token punctuation">.</span>seconds<span class="token punctuation">;</span> <span class="token comment">// => 100</span></code></pre><p>バランシングが行われていない Duration は、&quot;top-heavy&quot;であることが一般的です。top-heavy とは、<code>{ days: 45, hours: 10 }</code>のように、ゼロでない最大の単位がバランシングされていないことです。<code>{ days: 4, hours: 60 }</code>のように、バランシングが行われていない Duration で top-heavy でないものはめったに使われません。</p>
<h2 id="roundによる-duration-のバランシング"><a class="heading-link" href="#roundによる-duration-のバランシング"></a><code>round()</code>による Duration のバランシング</h3><p><code>Temporal.Duration.prototype.round()</code>を用いることで、Duration における各単位の繰り上げ計算や、Duration 全体のバランシングが行えます。</p>
<p>デフォルトでは、<code>round()</code>は、バランシングされていない top-heavy な Duration を拡張しようとはしません。つまり、入力される最大の単位は、出力においても最大の単位となります。</p>
<pre class="language-javascript"><code class="language-javascript">d <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Duration<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">minutes</span><span class="token operator">:</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token literal-property property">seconds</span><span class="token operator">:</span> <span class="token number">30</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => PT80M30S</span>
d<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">largestUnit</span><span class="token operator">:</span> <span class="token string">'auto'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => PT80M30S（変化なし）</span></code></pre><p>しかし、<code>round()</code>は最大の単位より小さな単位に関してはバランシングを行います。これは、バランシングされていない Duration が top-heavy でないという、レアケースでのみ発生します。</p>
<!-- prettier-ignore-start -->
<pre class="language-javascript"><code class="language-javascript">d <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Duration<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">minutes</span><span class="token operator">:</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token literal-property property">seconds</span><span class="token operator">:</span> <span class="token number">90</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => PT80M90S</span>
d<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">largestUnit</span><span class="token operator">:</span> <span class="token string">'auto'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// => PT81M30S（秒が分にバランシングされた、しかし分は時にバランシングされていない）</span></code></pre><!-- prettier-ignore-end -->

<p>Duration 全体をバランシングしたい場合は、<code>largestUnit</code>オプションを使用します：</p>
<pre class="language-javascript"><code class="language-javascript">d <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Duration<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">minutes</span><span class="token operator">:</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token literal-property property">seconds</span><span class="token operator">:</span> <span class="token number">90</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => PT80M90S</span>
d<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">largestUnit</span><span class="token operator">:</span> <span class="token string">'hour'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => PT1H21M30S（全体がバランシングされている）</span></code></pre><h2 id="基準点に対するバランシング"><a class="heading-link" href="#基準点に対するバランシング"></a>基準点に対するバランシング</h3><p>日や週、月、年に対するバランシングはさらに複雑になります。なぜなら、場合によってこれらの長さが変化するからです。デフォルトの ISO カレンダーでは一年は 365 日にも 366 日にもなり得ます。また、一ヶ月は 28、29、30、31 日のいずれにもなり得ます。さらに、その他のカレンダーでは、一年は 12 ヶ月でないことも、1 週間が 7 日間でないこともあり得ます。最後に、サマータイムが採用されている地域では 1 日は 24 時間ではない場合もあり得ます。</p>
<p>したがって、日、週、月、年のいずれかがゼロでないすべての<code>Duration</code>が表す長さは、それが開始する日時によって異なります。この潜在的な曖昧さを扱うために、Duration の開始点を指定するための<code>relativeTo</code>オプションが利用できます。<code>relativeTo</code>には、タイムゾーンを明示する<code>Temporal.ZonedDateTime</code>か、タイムゾーンを指定しない<code>Temporal.PlainDateTime</code>、またはこれらに解釈可能なものを指定します。<code>relativeTo</code>は、週、月、年のバランシングを行う際に必須です。</p>
<pre class="language-javascript"><code class="language-javascript">d <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Duration<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">days</span><span class="token operator">:</span> <span class="token number">370</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => P370D</span>
<span class="token comment">/* WRONG */</span> d<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">largestUnit</span><span class="token operator">:</span> <span class="token string">'year'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => RangeError（`relativeTo`が必要）</span>
d<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">largestUnit</span><span class="token operator">:</span> <span class="token string">'year'</span><span class="token punctuation">,</span> <span class="token literal-property property">relativeTo</span><span class="token operator">:</span> <span class="token string">'2019-01-01'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => P1Y5D</span>
d<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">largestUnit</span><span class="token operator">:</span> <span class="token string">'year'</span><span class="token punctuation">,</span> <span class="token literal-property property">relativeTo</span><span class="token operator">:</span> <span class="token string">'2020-01-01'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => P1Y4D（うるう年）</span></code></pre><p>日のバランシングを行う際には、<code>relativeTo</code>は必須ではありません。もし<code>relativeTo</code>が省略された場合には、1 日を 24 時間とみなして処理します。しかし、タイムゾーンに紐付いた Duration を扱う際には、サマータイムの影響を考慮するために、<code>Temporal.ZonedDateTime</code>を<code>relativeTo</code>とすることをおすすめします。</p>
<!-- prettier-ignore-start -->
<pre class="language-javascript"><code class="language-javascript">d <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Duration<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">hours</span><span class="token operator">:</span> <span class="token number">48</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => PT48H</span>
d<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">largestUnit</span><span class="token operator">:</span> <span class="token string">'day'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// => P2D</span>
d<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">largestUnit</span><span class="token operator">:</span> <span class="token string">'day'</span><span class="token punctuation">,</span> <span class="token literal-property property">relativeTo</span><span class="token operator">:</span> <span class="token string">'2020-03-08T00:00-08:00[America/Los_Angeles]'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// => P2DT1H</span>
  <span class="token comment">// （サマータイムが開始したことで時計が1時間分スキップされたから）</span></code></pre><!-- prettier-ignore-end -->

<h2 id="duration-の演算とバランシング"><a class="heading-link" href="#duration-の演算とバランシング"></a>Duration の演算とバランシング</h3><p>上記の<code>round()</code>に加えて、<code>add()</code>と<code>subtract()</code>もまた、<code>largestUnit</code>オプションによって Duration を、「完全に」または「top-heavy に」バランシングします。</p>
<p>デフォルトでは、<code>Temporal.Duration</code>インスタンスにおける<code>add()</code>と<code>subtract()</code>は、入力される 2 つのインスタンスのうち最大の単位を、出力するインスタンスの最大の単位とします。</p>
<pre class="language-javascript"><code class="language-javascript">d1 <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Duration<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">hours</span><span class="token operator">:</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token literal-property property">minutes</span><span class="token operator">:</span> <span class="token number">45</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => PT26H45M</span>
d2 <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Duration<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">minutes</span><span class="token operator">:</span> <span class="token number">30</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => PT30M</span>
d1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>d2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => PT27H15M</span></code></pre><p><code>largestUnit</code>オプションを使用して、入力される単位よりも大きな単位にバランシングすることもできます。</p>
<pre class="language-javascript"><code class="language-javascript">d1 <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Duration<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">minutes</span><span class="token operator">:</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token literal-property property">seconds</span><span class="token operator">:</span> <span class="token number">90</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => PT80M90S</span>
d2 <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Duration<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">minutes</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token literal-property property">seconds</span><span class="token operator">:</span> <span class="token number">15</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => PT100M15S</span>
d1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>d2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">largestUnit</span><span class="token operator">:</span> <span class="token string">'hour'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => PT3H1M45S (fully balanced)</span></code></pre><p><code>relativeTo</code>は、週、月、年（さらに、タイムゾーンに紐付いた Duration）のバランシングを行うために使用されます。
<code>relativeTo</code>の値は、<code>this</code>のもの（訳注：演算を呼び出している方の Duration、add メソッドの引数の方ではないということ、<code>this.add(other)</code>）として扱われるため、メソッドチェーンで呼び出す連続した演算で同じ<code>relativeTo</code>の値を使用できます。</p>
<!-- prettier-ignore-start -->
<pre class="language-javascript"><code class="language-javascript">d1 <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Duration<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">hours</span><span class="token operator">:</span> <span class="token number">48</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => PT48H</span>
d2 <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Duration<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">hours</span><span class="token operator">:</span> <span class="token number">24</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => PT24H</span>
d1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>d2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">largestUnit</span><span class="token operator">:</span> <span class="token string">'day'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// => P3D</span>
d1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>d2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">largestUnit</span><span class="token operator">:</span> <span class="token string">'day'</span><span class="token punctuation">,</span> <span class="token literal-property property">relativeTo</span><span class="token operator">:</span> <span class="token string">'2020-03-08T00:00-08:00[America/Los_Angeles]'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// => P3DT1H</span>
  <span class="token comment">// (because one clock hour was skipped by DST starting)</span></code></pre><!-- prettier-ignore-end -->

<h2 id="少数秒のシリアル化"><a class="heading-link" href="#少数秒のシリアル化"></a>少数秒のシリアル化</h3><p>通常、すべての Temporal オブジェクトは<code>toString()</code>メソッドによって文字列にシリアライズされ、<code>from()</code>によって復元できます。これは、<code>Temporal.Duration</code>においても同様です。</p>
<p>しかし、もし<code>milliseconds</code>、<code>microseconds</code>、<code>nanoseconds</code>のいずれかが 999 よりも大きい場合、<code>Temporal.Duration.from(duration.toString())</code>は、もとの Duration と同じにはなりません。復元されたオブジェクトは、もとのオブジェクトと同じ長さを表しますが、少数秒の部分は秒に対してバランシングされ 999 以下の値となります。例えば、1000 ナノ秒は 1 マイクロ秒になります。</p>
<p>これは、Duration のシリアル化に使用されている ISO 8601 形式が、少数秒の単位のセパレーターを提供しておらず、各単位を個別に指定できないためです。もし、少数秒をバランシングせずに<code>Temporal.Duration</code>をシリアライズしたい場合は、独自の方法で行うか、オブジェクトや JSON としてシリアライズする必要があります。</p>
    <footer>
      <p>
        This page includes a script which loads an implementation of Temporal in your browser.
        You can open a console in your browser's developer tools and try it out directly!
      </p>
      <p>View this or help contribute on <a href="https://github.com/tc39/proposal-temporal">GitHub</a>.</p>
    </footer>
  </body>
</html>
