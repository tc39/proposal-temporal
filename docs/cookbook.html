<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/kognise/water.css@latest/dist/light.min.css">
    <script type="application/javascript" src="./playground.js"></script>
    <script type="application/javascript" src="./mermaid.js"></script>
    <link rel="stylesheet" type="text/css" href="./prism.css">
    <script>mermaid.initialize({startOnLoad:true,flowchart:{useMaxWidth:false}});</script>
    <script>
      Temporal = { ...temporal.Temporal };
      Object.assign(Intl, temporal.Intl);
    </script>
    <style>
      /* https://github.com/kognise/water.css/blob/master/src/variables-light.css */
      :root {
        --background: #efefef;
        --text-muted: #999999;
        --text-bright: #000000;
        --text-width: 900px;
        --variable: #39a33c;
      }
      .mermaid svg { height: 13em; }
      body {
        font-size: 18px;
        max-width: var(--text-width);
        padding-top: 40px;  /* extra padding for banner */
      }
      pre { border-left: 4px solid var(--variable); }
      pre code[class*="language-"] { font-size: 0.85em; }
      pre[class*="language-"] { padding: 0.5em; }
      h2 { border-bottom: 2px solid var(--text-muted); margin-top: 2em; }
      h3 {
        border-bottom: 1px solid var(--text-muted);
        color: var(--text-muted);
        font-weight: normal;
      }
      h3 em { font-weight: bold; }
      h3 strong { color: var(--text-bright); }
      :not(h2) + h3 { margin-top: 2em; }
      footer {
        border-top: 1px solid var(--background);
        color: var(--text-muted);
        font-size: 0.8em;
        margin-top: 2em;
        padding-top: 10px;
      }
      .heading-link {
        left: calc((100vw - var(--text-width)) / 2 - 1.5em);
        opacity: 0;
        position: absolute;
        transition: opacity 150ms;
      }
      .heading-link:hover { text-decoration: none; }
      .heading-link::before { content: '¶'; }
      h3:hover .heading-link { opacity: 1; }
      .banner {
        /* Gradient from https://joshnh.com/weblog/how-to-make-an-alert-bar/ */
        background-color: #fce94f;
        background-image: linear-gradient(135deg,
                                          transparent,
                                          transparent 25%,
                                          rgba(0, 0, 0, .05) 25%,
                                          rgba(0, 0, 0, .05) 50%,
                                          transparent 50%,
                                          transparent 75%,
                                          rgba(0, 0, 0, .05) 75%,
                                          rgba(0, 0, 0, .05));
        background-size: 20px 20px;
        box-shadow: 0 5px 0 rgba(0, 0, 0, .1);
        left: 0;
        padding: 0.4em 0;
        position: absolute;
        text-align: center;
        top: 0;
        width: 100vw;
      }
    </style>
  </head>
  <body>
    <div class="banner">
      <strong>This polyfill is a work in progress.</strong>
      It does not represent the final API of this proposal, nor even the current consensus.
    </div>
<h1 id="temporal-cookbook-1">Temporal Cookbook</h1>
<h2 id="overview-1">Overview</h2>
<ul>
<li><a href="#overview">Overview</a>
</li>
<li><a href="#running-the-cookbook-files">Running the cookbook files</a>
</li>
<li><a href="#frequently-asked-questions">Frequently Asked Questions</a>
<ul>
<li><a href="#current-date-and-time">Current date and time</a>
</li>
<li><a href="#unix-timestamp">Unix timestamp</a>
</li>
</ul>
</li>
<li><a href="#converting-between-temporal-types-and-legacy-date">Converting between Temporal types and legacy Date</a>
<ul>
<li><a href="#absolute-from-legacy-date">Absolute from legacy Date</a>
</li>
</ul>
</li>
<li><a href="#construction">Construction</a>
<ul>
<li><a href="#time-zone-object-from-name">Time zone object from name</a>
</li>
<li><a href="#calendar-input-element">Calendar input element</a>
</li>
</ul>
</li>
<li><a href="#converting-between-types">Converting between types</a>
<ul>
<li><a href="#noon-on-a-particular-date">Noon on a particular date</a>
</li>
<li><a href="#birthday-in-2030">Birthday in 2030</a>
</li>
</ul>
</li>
<li><a href="#serialization">Serialization</a>
<ul>
<li><a href="#zoned-instant-from-instant-and-time-zone">Zoned instant from instant and time zone</a>
</li>
</ul>
</li>
<li><a href="#sorting">Sorting</a>
<ul>
<li><a href="#sort-datetimes">Sort DateTimes</a>
</li>
<li><a href="#sort-iso-datetime-strings">Sort ISO date/time strings</a>
</li>
</ul>
</li>
<li><a href="#rounding">Rounding</a>
<ul>
<li><a href="#round-a-time-down-to-whole-hours">Round a time down to whole hours</a>
</li>
</ul>
</li>
<li><a href="#time-zone-conversion">Time zone conversion</a>
<ul>
<li><a href="#preserving-local-time">Preserving local time</a>
</li>
<li><a href="#preserving-absolute-instant">Preserving absolute instant</a>
</li>
<li><a href="#daily-occurrence-in-local-time">Daily occurrence in local time</a>
</li>
<li><a href="#utc-offset-for-a-zoned-event-as-a-string">UTC offset for a zoned event, as a string</a>
</li>
<li><a href="#utc-offset-for-a-zoned-event-as-a-number-of-seconds">UTC offset for a zoned event, as a number of seconds</a>
</li>
<li><a href="#offset-between-two-time-zones-at-an-instant">Offset between two time zones at an instant</a>
</li>
<li><a href="#dealing-with-dates-and-times-in-a-fixed-location">Dealing with dates and times in a fixed location</a>
</li>
<li><a href="#book-a-meeting-across-time-zones">Book a meeting across time zones</a>
</li>
</ul>
</li>
<li><a href="#arithmetic">Arithmetic</a>
<ul>
<li><a href="#how-many-days-until-a-future-date">How many days until a future date</a>
</li>
<li><a href="#unit-constrained-duration-between-now-and-a-pastfuture-zoned-event">Unit-constrained duration between now and a past/future zoned event</a>
</li>
<li><a href="#nearest-offset-transition-in-a-time-zone">Nearest offset transition in a time zone</a>
</li>
<li><a href="#comparison-of-an-instant-to-business-hours">Comparison of an instant to business hours</a>
</li>
<li><a href="#flight-arrivaldepartureduration">Flight arrival/departure/duration</a>
</li>
<li><a href="#push-back-a-launch-date">Push back a launch date</a>
</li>
<li><a href="#schedule-a-reminder-ahead-of-matching-a-record-setting-duration">Schedule a reminder ahead of matching a record-setting duration</a>
</li>
<li><a href="#nth-weekday-of-the-month">Nth weekday of the month</a>
</li>
<li><a href="#manipulating-the-day-of-the-month">Manipulating the day of the month</a>
</li>
<li><a href="#same-date-in-another-month">Same date in another month</a>
</li>
<li><a href="#next-weekly-occurrence">Next weekly occurrence</a>
</li>
<li><a href="#weekday-of-yearly-occurrence">Weekday of yearly occurrence</a>
</li>
</ul>
</li>
</ul>

<h2 id="running-the-cookbook-files-1">Running the cookbook files</h2>
<p>Running cookbook files: see instructions in <a href="https://github.com/tc39/proposal-temporal/tree/main/polyfill#running-cookbook-files">../polyfill/README.md</a></p>
<h2 id="frequently-asked-questions-1">Frequently Asked Questions</h2>
<p>These are some of the most common tasks that people ask questions about on StackOverflow with legacy Date.
Here&#39;s how they would look using Temporal.</p>
<h3 id="current-date-and-time"><a class="heading-link" href="#current-date-and-time"></a>Current date and time</h3><p>How to get the current date and time in the local time zone?</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">/**
 * Get the current date in JavaScript
 * This is a popular question on Stack Overflow for dates in JS
 * https://stackoverflow.com/questions/1531093/how-do-i-get-the-current-date-in-javascript
 *
 */</span>

<span class="token keyword">const</span> dateTime <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>now<span class="token punctuation">.</span><span class="token function">dateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Gets the current date</span>
dateTime<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns the date in ISO 8601 date format</span>
</code></pre><h3 id="unix-timestamp"><a class="heading-link" href="#unix-timestamp"></a>Unix timestamp</h3><p>How to get a Unix timestamp?</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">/**
 * Get a (Unix) timestamp in JavaScript
 * This is the No.1 voted question on Stack Overflow for dates in JS
 * https://stackoverflow.com/questions/221294/how-do-you-get-a-timestamp-in-javascript
 *
 */</span>

<span class="token keyword">const</span> timeStamp <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>now<span class="token punctuation">.</span><span class="token function">absolute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Timestamp in Milliseconds</span>
timeStamp<span class="token punctuation">.</span><span class="token function">getEpochMilliseconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Timestamp in Seconds</span>
timeStamp<span class="token punctuation">.</span><span class="token function">getEpochSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h2 id="converting-between-temporal-types-and-legacy-date-1">Converting between Temporal types and legacy Date</h2>
<h3 id="absolute-from-legacy-date"><a class="heading-link" href="#absolute-from-legacy-date"></a>Absolute from legacy Date</h3><p>Map a legacy ECMAScript Date instance into a Temporal.Absolute instance corresponding to the same instant in absolute time.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> legacyDate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">'1970-01-01T00:00:01Z'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Convert legacy Date to Temporal.Absolute</span>
<span class="token keyword">const</span> absolute <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Absolute<span class="token punctuation">.</span><span class="token function">fromEpochMilliseconds</span><span class="token punctuation">(</span>legacyDate<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">assert</span><span class="token punctuation">(</span>absolute <span class="token keyword">instanceof</span> <span class="token class-name">Temporal<span class="token punctuation">.</span>Absolute</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h2 id="construction-1">Construction</h2>
<h3 id="time-zone-object-from-name"><a class="heading-link" href="#time-zone-object-from-name"></a>Time zone object from name</h3><p><code>Temporal.TimeZone.from()</code> can convert an IANA time zone name into a <code>Temporal.TimeZone</code> object.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// Construct a Temporal.TimeZone from an IANA name:</span>
<span class="token keyword">const</span> tz <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>TimeZone<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'Europe/London'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cast the timezone back to an IANA name, two ways:</span>
tz<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Europe/London</span>
tz<span class="token punctuation">.</span>name<span class="token punctuation">;</span> <span class="token comment">// Europe/London</span>
</code></pre><h3 id="calendar-input-element"><a class="heading-link" href="#calendar-input-element"></a>Calendar input element</h3><p>You can use Temporal objects to set properties on a calendar control.
Here is an example using an HTML <code>&lt;input type=&quot;date&quot;&gt;</code> element with any day beyond “today” disabled and not selectable.</p>
<input type="date" id="calendar-input">

<script type="text/javascript">
const datePicker = document.getElementById('calendar-input');
const today = Temporal.now.date();
datePicker.max = today;
datePicker.value = today;

</script>

<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> datePicker <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'calendar-input'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> today <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>now<span class="token punctuation">.</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
datePicker<span class="token punctuation">.</span>max <span class="token operator">=</span> today<span class="token punctuation">;</span>
datePicker<span class="token punctuation">.</span>value <span class="token operator">=</span> today<span class="token punctuation">;</span>
</code></pre><h2 id="converting-between-types-1">Converting between types</h2>
<h3 id="noon-on-a-particular-date"><a class="heading-link" href="#noon-on-a-particular-date"></a>Noon on a particular date</h3><p>An example of combining a calendar date (<code>Temporal.Date</code>) and a wall-clock time (<code>Temporal.Time</code>) into a <code>Temporal.DateTime</code>.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> date <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Date<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'2020-05-14'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> noonOnDate <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">withTime</span><span class="token punctuation">(</span>Temporal<span class="token punctuation">.</span>Time<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> hour<span class="token operator">:</span> <span class="token number">12</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">assert</span><span class="token punctuation">(</span>noonOnDate <span class="token keyword">instanceof</span> <span class="token class-name">Temporal<span class="token punctuation">.</span>DateTime</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>noonOnDate<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'2020-05-14T12:00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="birthday-in-2030"><a class="heading-link" href="#birthday-in-2030"></a>Birthday in 2030</h3><p>An example of combining a day on the calendar (<code>Temporal.MonthDay</code>) and a year into a <code>Temporal.Date</code>.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> birthday <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>MonthDay<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'12-15'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> birthdayIn2030 <span class="token operator">=</span> birthday<span class="token punctuation">.</span><span class="token function">withYear</span><span class="token punctuation">(</span><span class="token number">2030</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
birthdayIn2030<span class="token punctuation">.</span>dayOfWeek<span class="token punctuation">;</span> <span class="token comment">// => 7</span>

<span class="token function">assert</span><span class="token punctuation">(</span>birthdayIn2030 <span class="token keyword">instanceof</span> <span class="token class-name">Temporal<span class="token punctuation">.</span>Date</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>birthdayIn2030<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'2030-12-15'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h2 id="serialization-1">Serialization</h2>
<h3 id="zoned-instant-from-instant-and-time-zone"><a class="heading-link" href="#zoned-instant-from-instant-and-time-zone"></a>Zoned instant from instant and time zone</h3><p>Use the optional parameter of <code>Temporal.Absolute.prototype.toString()</code> to map a Temporal.Absolute instance and a time zone name into a string serialization of the local time in that zone corresponding to the instant in absolute time.</p>
<p>Without the parameter, <code>Temporal.Absolute.prototype.toString()</code> gives a serialization in UTC time.
Using the parameter is useful if you need your serialized strings to be in a specific time zone.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> absoluteTime <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Absolute<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'2020-01-03T10:41:51Z'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> result <span class="token operator">=</span> absoluteTime<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'Europe/Paris'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token string">'2020-01-03T11:41:51+01:00[Europe/Paris]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>Temporal<span class="token punctuation">.</span>Absolute<span class="token punctuation">.</span><span class="token function">compare</span><span class="token punctuation">(</span>absoluteTime<span class="token punctuation">,</span> Temporal<span class="token punctuation">.</span>Absolute<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// With an offset:</span>

<span class="token keyword">const</span> result2 <span class="token operator">=</span> absoluteTime<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'-07:00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>result2<span class="token punctuation">,</span> <span class="token string">'2020-01-03T03:41:51-07:00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// With a Temporal.TimeZone object:</span>

<span class="token keyword">const</span> timeZone <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>TimeZone<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'Asia/Seoul'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> result3 <span class="token operator">=</span> absoluteTime<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>timeZone<span class="token punctuation">)</span><span class="token punctuation">;</span>

assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>result3<span class="token punctuation">,</span> <span class="token string">'2020-01-03T19:41:51+09:00[Asia/Seoul]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h2 id="sorting-1">Sorting</h2>
<p>Each Temporal type has a <code>compare()</code> static method, which can be passed to <code>Array.prototype.sort()</code> as the compare function in order to sort an array of Temporal types.</p>
<h3 id="sort-datetimes"><a class="heading-link" href="#sort-datetimes"></a>Sort DateTimes</h3><p>Sort a list of <code>Temporal.DateTime</code>s, for example in order to get a conference schedule in the correct order.
Sorting other Temporal types would work exactly the same way as this.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">/**
 * getSortedLocalDateTimes will sort an array of zoneless Temporal.DateTime instances by the
 * corresponding local date and time of day (e.g., for building a conference schedule).
 *
 *
 * @param {Temporal.DateTime[]} dateTimes - This is a DateTime instance
 * @param {boolean} direction - reverse
 * @returns {Temporal.DateTime[]} the array from dateTimes, sorted
 */</span>
<span class="token keyword">function</span> <span class="token function">getSortedLocalDateTimes</span><span class="token punctuation">(</span><span class="token parameter">dateTimes<span class="token punctuation">,</span> reverse <span class="token operator">=</span> <span class="token boolean">false</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> newDateTimes <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>dateTimes<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>Temporal<span class="token punctuation">.</span>DateTime<span class="token punctuation">.</span>compare<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> reverse <span class="token operator">?</span> newDateTimes<span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> newDateTimes<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Sorting some conferences without timezones for example vue.js Amsterdam 2020</span>
<span class="token keyword">let</span> a <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>DateTime<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  year<span class="token operator">:</span> <span class="token number">2020</span><span class="token punctuation">,</span>
  day<span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
  month<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  hour<span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
  minute<span class="token operator">:</span> <span class="token number">45</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Introduction</span>
<span class="token keyword">let</span> b <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>DateTime<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  year<span class="token operator">:</span> <span class="token number">2020</span><span class="token punctuation">,</span>
  day<span class="token operator">:</span> <span class="token number">21</span><span class="token punctuation">,</span>
  month<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  hour<span class="token operator">:</span> <span class="token number">13</span><span class="token punctuation">,</span>
  minute<span class="token operator">:</span> <span class="token number">10</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Lunch Break</span>
<span class="token keyword">let</span> c <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>DateTime<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  year<span class="token operator">:</span> <span class="token number">2020</span><span class="token punctuation">,</span>
  day<span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
  month<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  hour<span class="token operator">:</span> <span class="token number">15</span><span class="token punctuation">,</span>
  minute<span class="token operator">:</span> <span class="token number">30</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Coffee Break</span>
<span class="token keyword">const</span> results <span class="token operator">=</span> <span class="token function">getSortedLocalDateTimes</span><span class="token punctuation">(</span><span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
assert<span class="token punctuation">.</span><span class="token function">deepEqual</span><span class="token punctuation">(</span>
  results<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token operator">=></span> x<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">'2020-02-20T08:45'</span><span class="token punctuation">,</span> <span class="token string">'2020-02-20T15:30'</span><span class="token punctuation">,</span> <span class="token string">'2020-02-21T13:10'</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="sort-iso-datetime-strings"><a class="heading-link" href="#sort-iso-datetime-strings"></a>Sort ISO date/time strings</h3><p>Sort a list of ISO 8601 date/time strings, for example to place log entries in order.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">/**
 * getSortedInstants will sort an array of strings (each of which is parseable
 * as a Temporal.Absolute and may or may not include an IANA time zone name)
 * by the corresponding absolute time (e.g., for presenting global log events
 * sequentially).
 *
 * @param {string[]} parseableAbsoluteStrings - a group of ISO Strings
 * @param {boolean} reverse - ascending or descending order
 * @returns {string[]} the array from parseableAbsoluteStrings, sorted
 */</span>
<span class="token keyword">function</span> <span class="token function">getSortedInstants</span><span class="token punctuation">(</span><span class="token parameter">parseableAbsoluteStrings<span class="token punctuation">,</span> reverse <span class="token operator">=</span> <span class="token boolean">false</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> sortedAbsoluteTimes <span class="token operator">=</span> parseableAbsoluteStrings
    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">[</span>v<span class="token punctuation">,</span> Temporal<span class="token punctuation">.</span>Absolute<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span><span class="token punctuation">,</span> abs1<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> abs2<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> Temporal<span class="token punctuation">.</span>Absolute<span class="token punctuation">.</span><span class="token function">compare</span><span class="token punctuation">(</span>abs1<span class="token punctuation">,</span> abs2<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>str<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> reverse <span class="token operator">?</span> sortedAbsoluteTimes<span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> sortedAbsoluteTimes<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// simple string comparison order would not be correct here:</span>
<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token string">'2020-01-23T17:04:36.491865121-08:00'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token string">'2020-02-10T17:04:36.491865121-08:00'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> c <span class="token operator">=</span> <span class="token string">'2020-04-01T05:01:00-05:00[America/New_York]'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> d <span class="token operator">=</span> <span class="token string">'2020-04-01T10:00:00+01:00[Europe/London]'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> e <span class="token operator">=</span> <span class="token string">'2020-04-01T11:02:00+02:00[Europe/Berlin]'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> results <span class="token operator">=</span> <span class="token function">getSortedInstants</span><span class="token punctuation">(</span><span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> e<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// results will have correct order</span>
assert<span class="token punctuation">.</span><span class="token function">deepEqual</span><span class="token punctuation">(</span>results<span class="token punctuation">,</span> <span class="token punctuation">[</span>
  <span class="token string">'2020-01-23T17:04:36.491865121-08:00'</span><span class="token punctuation">,</span>
  <span class="token string">'2020-02-10T17:04:36.491865121-08:00'</span><span class="token punctuation">,</span>
  <span class="token string">'2020-04-01T10:00:00+01:00[Europe/London]'</span><span class="token punctuation">,</span>
  <span class="token string">'2020-04-01T05:01:00-05:00[America/New_York]'</span><span class="token punctuation">,</span>
  <span class="token string">'2020-04-01T11:02:00+02:00[Europe/Berlin]'</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h2 id="rounding-1">Rounding</h2>
<h3 id="round-a-time-down-to-whole-hours"><a class="heading-link" href="#round-a-time-down-to-whole-hours"></a>Round a time down to whole hours</h3><p>Use the <code>with()</code> method of each Temporal type if you want to round or balance the fields.
Here&#39;s an example of rounding a time <em>down</em> to the previously occurring whole hour:</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> time <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Time<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'12:38:28.138818731'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// explicitly:</span>
<span class="token keyword">let</span> wholeHour <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span><span class="token punctuation">{</span> minute<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> second<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> millisecond<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> microsecond<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> nanosecond<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>wholeHour<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'12:00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// or, taking advantage of 0 being the default for time fields:</span>
wholeHour <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Time<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> hour<span class="token operator">:</span> time<span class="token punctuation">.</span>hour <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>wholeHour<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'12:00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h2 id="time-zone-conversion-1">Time zone conversion</h2>
<h3 id="preserving-local-time"><a class="heading-link" href="#preserving-local-time"></a>Preserving local time</h3><p>Map a zoneless date and time of day into a <code>Temporal.Absolute</code> instance at which the local date and time of day in a specified time zone matches it.
This is easily done with <code>dateTime.inTimeZone()</code>, but here is an example of implementing different disambiguation behaviours than the <code>&quot;earlier&quot;</code>, <code>&quot;later&quot;</code>, and <code>&quot;reject&#39;</code> ones built in to Temporal.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">/**
 * Get an absolute time corresponding with a calendar date / wall-clock time in
 * a particular time zone, the same as Temporal.TimeZone.getAbsoluteFor() or
 * Temporal.DateTime.inTimeZone(), but with more disambiguation options.
 *
 * As well as the default Temporal disambiguation options 'earlier', 'later',
 * and 'reject', there are additional options possible:
 *
 * - 'earlierLater': Same as what the Moment Timezone and Luxon libraries do;
 *   equivalent to 'earlier' when turning the clock back, and 'later' when
 *   setting the clock forward.
 * - 'clipEarlier': Equivalent to 'earlier' when turning the clock back, and
 *   when setting the clock forward returns the time just before the clock
 *   changes.
 * - 'clipLater': Equivalent to 'later' when turning the clock back, and when
 *   setting the clock forward returns the exact time of the clock change.
 *
 * @param {Temporal.DateTime} dateTime - Calendar date and wall-clock time to
 *   convert
 * @param {Temporal.TimeZone} timeZone - Time zone in which to consider the
 *   wall-clock time
 * @param {string} disambiguation - Disambiguation mode, see description.
 * @returns {Temporal.Absolute} Absolute time in timeZone at the time of the
 *   calendar date and wall-clock time from dateTime
 */</span>
<span class="token keyword">function</span> <span class="token function">getInstantWithLocalTimeInZone</span><span class="token punctuation">(</span>dateTime<span class="token punctuation">,</span> timeZone<span class="token punctuation">,</span> disambiguation <span class="token operator">=</span> <span class="token string">'earlier'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Handle the built-in modes first</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'earlier'</span><span class="token punctuation">,</span> <span class="token string">'later'</span><span class="token punctuation">,</span> <span class="token string">'reject'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>disambiguation<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> timeZone<span class="token punctuation">.</span><span class="token function">getAbsoluteFor</span><span class="token punctuation">(</span>dateTime<span class="token punctuation">,</span> <span class="token punctuation">{</span> disambiguation <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> possible <span class="token operator">=</span> timeZone<span class="token punctuation">.</span><span class="token function">getPossibleAbsolutesFor</span><span class="token punctuation">(</span>dateTime<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Return only possibility if no disambiguation needed</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>possible<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> possible<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">switch</span> <span class="token punctuation">(</span>disambiguation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'earlierLater'</span><span class="token operator">:</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>possible<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> timeZone<span class="token punctuation">.</span><span class="token function">getAbsoluteFor</span><span class="token punctuation">(</span>dateTime<span class="token punctuation">,</span> <span class="token punctuation">{</span> disambiguation<span class="token operator">:</span> <span class="token string">'later'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> possible<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'clipEarlier'</span><span class="token operator">:</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>possible<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> before <span class="token operator">=</span> dateTime<span class="token punctuation">.</span><span class="token function">inTimeZone</span><span class="token punctuation">(</span>timeZone<span class="token punctuation">,</span> <span class="token punctuation">{</span> disambiguation<span class="token operator">:</span> <span class="token string">'earlier'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> timeZone
          <span class="token punctuation">.</span><span class="token function">getTransitions</span><span class="token punctuation">(</span>before<span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">minus</span><span class="token punctuation">(</span><span class="token punctuation">{</span> nanoseconds<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> possible<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'clipLater'</span><span class="token operator">:</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>possible<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> before <span class="token operator">=</span> dateTime<span class="token punctuation">.</span><span class="token function">inTimeZone</span><span class="token punctuation">(</span>timeZone<span class="token punctuation">,</span> <span class="token punctuation">{</span> disambiguation<span class="token operator">:</span> <span class="token string">'earlier'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> timeZone<span class="token punctuation">.</span><span class="token function">getTransitions</span><span class="token punctuation">(</span>before<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> possible<span class="token punctuation">[</span>possible<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RangeError</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">invalid disambiguation </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>disambiguation<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> germany <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>TimeZone<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'Europe/Berlin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> nonexistentGermanWallTime <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>DateTime<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'2019-03-31T02:45'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> germanResults <span class="token operator">=</span> <span class="token punctuation">{</span>
  earlier<span class="token operator">:</span> <span class="token comment">/*     */</span> <span class="token string">'2019-03-31T01:45+01:00[Europe/Berlin]'</span><span class="token punctuation">,</span>
  later<span class="token operator">:</span> <span class="token comment">/*       */</span> <span class="token string">'2019-03-31T03:45+02:00[Europe/Berlin]'</span><span class="token punctuation">,</span>
  earlierLater<span class="token operator">:</span> <span class="token comment">/**/</span> <span class="token string">'2019-03-31T03:45+02:00[Europe/Berlin]'</span><span class="token punctuation">,</span>
  clipEarlier<span class="token operator">:</span> <span class="token comment">/* */</span> <span class="token string">'2019-03-31T01:59:59.999999999+01:00[Europe/Berlin]'</span><span class="token punctuation">,</span>
  clipLater<span class="token operator">:</span> <span class="token comment">/*   */</span> <span class="token string">'2019-03-31T03:00+02:00[Europe/Berlin]'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">[</span>disambiguation<span class="token punctuation">,</span> result<span class="token punctuation">]</span> <span class="token keyword">of</span> Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>germanResults<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>
    <span class="token function">getInstantWithLocalTimeInZone</span><span class="token punctuation">(</span>nonexistentGermanWallTime<span class="token punctuation">,</span> germany<span class="token punctuation">,</span> disambiguation<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>germany<span class="token punctuation">)</span><span class="token punctuation">,</span>
    result
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> brazilEast <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>TimeZone<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'America/Sao_Paulo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> doubleEasternBrazilianWallTime <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>DateTime<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'2019-02-16T23:45'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> brazilianResults <span class="token operator">=</span> <span class="token punctuation">{</span>
  earlier<span class="token operator">:</span> <span class="token comment">/*     */</span> <span class="token string">'2019-02-16T23:45-02:00[America/Sao_Paulo]'</span><span class="token punctuation">,</span>
  later<span class="token operator">:</span> <span class="token comment">/*       */</span> <span class="token string">'2019-02-16T23:45-03:00[America/Sao_Paulo]'</span><span class="token punctuation">,</span>
  earlierLater<span class="token operator">:</span> <span class="token comment">/**/</span> <span class="token string">'2019-02-16T23:45-02:00[America/Sao_Paulo]'</span><span class="token punctuation">,</span>
  clipEarlier<span class="token operator">:</span> <span class="token comment">/* */</span> <span class="token string">'2019-02-16T23:45-02:00[America/Sao_Paulo]'</span><span class="token punctuation">,</span>
  clipLater<span class="token operator">:</span> <span class="token comment">/*   */</span> <span class="token string">'2019-02-16T23:45-03:00[America/Sao_Paulo]'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">[</span>disambiguation<span class="token punctuation">,</span> result<span class="token punctuation">]</span> <span class="token keyword">of</span> Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>brazilianResults<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>
    <span class="token function">getInstantWithLocalTimeInZone</span><span class="token punctuation">(</span>doubleEasternBrazilianWallTime<span class="token punctuation">,</span> brazilEast<span class="token punctuation">,</span> disambiguation<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>brazilEast<span class="token punctuation">)</span><span class="token punctuation">,</span>
    result
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="preserving-absolute-instant"><a class="heading-link" href="#preserving-absolute-instant"></a>Preserving absolute instant</h3><p>Map a zoned date and time of day into a string serialization of the local time in a target zone at the corresponding instant in absolute time.
This could be used when converting user-input date-time values between time zones.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">/**
 * Takes a local date and time in one time zone, and serializes it to a string
 * expressing the local date and time in another time zone.
 *
 * If `sourceDateTime` doesn't exist in `sourceTimeZone`, or exists twice, then
 * an error will be thrown by default.
 * Usually this is what you want. (FIXME: but is it?)
 * Use `sourceDisambiguationPolicy` to change this behaviour.
 *
 * @param {Temporal.DateTime} sourceDateTime - The local date and time
 * @param {Temporal.TimeZone} sourceTimeZone - The time zone for
 *  `sourceDateTime`
 * @param {Temporal.TimeZone} targetTimeZone - The time zone for the
 *  return value
 * @param {string} [sourceDisambiguationPolicy=reject] - what to do when
 *  `sourceDateTime` is ambiguous
 * @returns {string} String indicating the time with time zone designation
 */</span>
<span class="token keyword">function</span> <span class="token function">getParseableZonedStringWithLocalTimeInOtherZone</span><span class="token punctuation">(</span>
  sourceDateTime<span class="token punctuation">,</span>
  sourceTimeZone<span class="token punctuation">,</span>
  targetTimeZone<span class="token punctuation">,</span>
  sourceDisambiguationPolicy <span class="token operator">=</span> <span class="token string">'reject'</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> instant <span class="token operator">=</span> sourceDateTime<span class="token punctuation">.</span><span class="token function">inTimeZone</span><span class="token punctuation">(</span>sourceTimeZone<span class="token punctuation">,</span> <span class="token punctuation">{</span> disambiguation<span class="token operator">:</span> sourceDisambiguationPolicy <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> instant<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>targetTimeZone<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">getParseableZonedStringWithLocalTimeInOtherZone</span><span class="token punctuation">(</span>
  Temporal<span class="token punctuation">.</span>DateTime<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'2020-01-09T00:00'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  Temporal<span class="token punctuation">.</span>TimeZone<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'America/Chicago'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  Temporal<span class="token punctuation">.</span>TimeZone<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'America/Los_Angeles'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// On this date, when it's midnight in Chicago, it's 10 PM the previous night in LA</span>
assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token string">'2020-01-08T22:00-08:00[America/Los_Angeles]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>Here is another example similar to the previous one, using the time zone for future events.
The times and locations of a series of future meetings are stored as a pair of strings: one for the calendar date and wall-clock time, and one for the time zone.
They cannot be stored as an absolute point in UTC because between now and the time when the event happens, the time zone rules for daylight saving time could change &mdash; for example, Brazil abolished daylight saving time in 2019 &mdash; but the meeting would still be held at the same wall-clock time on that date.
So if the time zone rules changed, the event&#39;s absolute point in time would change.</p>
<p>This example calculates the starting times of all the Ecma TC39 meetings in 2019, in local time in Tokyo.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// Dates of the 2019 TC39 meetings:</span>
<span class="token keyword">const</span> tc39meetings <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    dateTime<span class="token operator">:</span> <span class="token string">'2019-01-28T10:00'</span><span class="token punctuation">,</span>
    timeZone<span class="token operator">:</span> <span class="token string">'America/Phoenix'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    dateTime<span class="token operator">:</span> <span class="token string">'2019-03-26T10:00'</span><span class="token punctuation">,</span>
    timeZone<span class="token operator">:</span> <span class="token string">'America/New_York'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    dateTime<span class="token operator">:</span> <span class="token string">'2019-06-04T10:00'</span><span class="token punctuation">,</span>
    timeZone<span class="token operator">:</span> <span class="token string">'Europe/Berlin'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    dateTime<span class="token operator">:</span> <span class="token string">'2019-07-23T10:00'</span><span class="token punctuation">,</span>
    timeZone<span class="token operator">:</span> <span class="token string">'America/Los_Angeles'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    dateTime<span class="token operator">:</span> <span class="token string">'2019-10-01T10:00'</span><span class="token punctuation">,</span>
    timeZone<span class="token operator">:</span> <span class="token string">'America/New_York'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    dateTime<span class="token operator">:</span> <span class="token string">'2019-12-03T10:00'</span><span class="token punctuation">,</span>
    timeZone<span class="token operator">:</span> <span class="token string">'America/Los_Angeles'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// To follow the meetings remotely from Tokyo, calculate the times you would</span>
<span class="token comment">// need to join:</span>
<span class="token keyword">const</span> localTimeZone <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>TimeZone<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'Asia/Tokyo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> localTimes <span class="token operator">=</span> tc39meetings<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> dateTime<span class="token punctuation">,</span> timeZone <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Temporal<span class="token punctuation">.</span>DateTime<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>dateTime<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">inTimeZone</span><span class="token punctuation">(</span>timeZone<span class="token punctuation">,</span> <span class="token punctuation">{</span> disambiguation<span class="token operator">:</span> <span class="token string">'reject'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">inTimeZone</span><span class="token punctuation">(</span>localTimeZone<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

assert<span class="token punctuation">.</span><span class="token function">deepEqual</span><span class="token punctuation">(</span>
  localTimes<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">dt</span><span class="token punctuation">)</span> <span class="token operator">=></span> dt<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span>
    <span class="token string">'2019-01-29T02:00'</span><span class="token punctuation">,</span>
    <span class="token string">'2019-03-26T23:00'</span><span class="token punctuation">,</span>
    <span class="token string">'2019-06-04T17:00'</span><span class="token punctuation">,</span>
    <span class="token string">'2019-07-24T02:00'</span><span class="token punctuation">,</span>
    <span class="token string">'2019-10-01T23:00'</span><span class="token punctuation">,</span>
    <span class="token string">'2019-12-04T03:00'</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="daily-occurrence-in-local-time"><a class="heading-link" href="#daily-occurrence-in-local-time"></a>Daily occurrence in local time</h3><p>Similar to the previous recipe, calculate the absolute times of a daily occurrence that happens at a particular local time in a particular time zone.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">/**
 * Returns an iterator of the absolute times corresponding to a daily occurrence
 * starting on a particular date, and happening at a particular local time in a
 * particular time zone.
 *
 * @param {Temporal.Date} startDate - Starting date
 * @param {Temporal.Time} time - Local time that event occurs at
 * @param {Temporal.TimeZone} timeZone - Time zone in which event is defined
 */</span>
<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">calculateDailyOccurrence</span><span class="token punctuation">(</span><span class="token parameter">startDate<span class="token punctuation">,</span> time<span class="token punctuation">,</span> timeZone</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> date <span class="token operator">=</span> startDate<span class="token punctuation">;</span> <span class="token punctuation">;</span> date <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">plus</span><span class="token punctuation">(</span><span class="token punctuation">{</span> days<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">yield</span> date<span class="token punctuation">.</span><span class="token function">withTime</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">inTimeZone</span><span class="token punctuation">(</span>timeZone<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Daily meeting at 8 AM California time</span>
<span class="token keyword">const</span> startDate <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Date<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'2017-03-10'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> time <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Time<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'08:00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> timeZone <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>TimeZone<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'America/Los_Angeles'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> iter <span class="token operator">=</span> <span class="token function">calculateDailyOccurrence</span><span class="token punctuation">(</span>startDate<span class="token punctuation">,</span> time<span class="token punctuation">,</span> timeZone<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">assert</span><span class="token punctuation">(</span>iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'2017-03-10T16:00:00.000000000Z'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">assert</span><span class="token punctuation">(</span>iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'2017-03-11T16:00:00.000000000Z'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// DST change:</span>
<span class="token function">assert</span><span class="token punctuation">(</span>iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'2017-03-12T15:00:00.000000000Z'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">assert</span><span class="token punctuation">(</span>iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'2017-03-13T15:00:00.000000000Z'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="utc-offset-for-a-zoned-event-as-a-string"><a class="heading-link" href="#utc-offset-for-a-zoned-event-as-a-string"></a>UTC offset for a zoned event, as a string</h3><p>Use <code>Temporal.TimeZone.getOffsetStringFor()</code> to map a <code>Temporal.Absolute</code> instance and a time zone into the UTC offset at that instant in that time zone, as a string.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> instant <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Absolute<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'2020-01-09T00:00Z'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> nyc <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>TimeZone<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'America/New_York'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

nyc<span class="token punctuation">.</span><span class="token function">getOffsetStringFor</span><span class="token punctuation">(</span>instant<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => -05:00</span>
</code></pre><h3 id="utc-offset-for-a-zoned-event-as-a-number-of-seconds"><a class="heading-link" href="#utc-offset-for-a-zoned-event-as-a-number-of-seconds"></a>UTC offset for a zoned event, as a number of seconds</h3><p>Similarly, use <code>Temporal.TimeZone.getOffsetNanosecondsFor()</code> to do the same thing for the offset as a number of seconds.
(Remember to divide by 10<sup>9</sup> to convert nanoseconds to seconds.)</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> instant <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Absolute<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'2020-01-09T00:00Z'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> nyc <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>TimeZone<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'America/New_York'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

nyc<span class="token punctuation">.</span><span class="token function">getOffsetNanosecondsFor</span><span class="token punctuation">(</span>instant<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1e9</span><span class="token punctuation">;</span> <span class="token comment">// => -18000</span>
</code></pre><h3 id="offset-between-two-time-zones-at-an-instant"><a class="heading-link" href="#offset-between-two-time-zones-at-an-instant"></a>Offset between two time zones at an instant</h3><p>Also using <code>Temporal.TimeZone.getOffsetNanosecondsFor()</code>, we can map a <code>Temporal.Absolute</code> instance and two time zones into the signed difference of UTC offsets between those time zones at that instant, as a number of seconds.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">/**
 * Returns the number of seconds' difference between the UTC offsets of two time
 * zones, at a particular moment in time.
 *
 * @param {Temporal.Absolute} instant - A moment in time
 * @param {Temporal.TimeZone} sourceTimeZone - A time zone to examine
 * @param {Temporal.TimeZone} targetTimeZone - A second time zone to examine
 * @returns {number} The number of seconds difference between the time zones'
 *   UTC offsets
 */</span>
<span class="token keyword">function</span> <span class="token function">getUtcOffsetDifferenceSecondsAtInstant</span><span class="token punctuation">(</span><span class="token parameter">instant<span class="token punctuation">,</span> sourceTimeZone<span class="token punctuation">,</span> targetTimeZone</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> sourceOffsetNs <span class="token operator">=</span> sourceTimeZone<span class="token punctuation">.</span><span class="token function">getOffsetNanosecondsFor</span><span class="token punctuation">(</span>instant<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> targetOffsetNs <span class="token operator">=</span> targetTimeZone<span class="token punctuation">.</span><span class="token function">getOffsetNanosecondsFor</span><span class="token punctuation">(</span>instant<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>targetOffsetNs <span class="token operator">-</span> sourceOffsetNs<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1e9</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> instant <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Absolute<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'2020-01-09T00:00Z'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> nyc <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>TimeZone<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'America/New_York'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> chicago <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>TimeZone<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'America/Chicago'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// At this instant, Chicago is 3600 seconds earlier than New York</span>
assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token function">getUtcOffsetDifferenceSecondsAtInstant</span><span class="token punctuation">(</span>instant<span class="token punctuation">,</span> nyc<span class="token punctuation">,</span> chicago<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3600</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="dealing-with-dates-and-times-in-a-fixed-location"><a class="heading-link" href="#dealing-with-dates-and-times-in-a-fixed-location"></a>Dealing with dates and times in a fixed location</h3><p>Here is an example of Temporal used in a graph, showing fictitious activity for a storage tank in a fixed location (Stockholm, Sweden).
The graph always starts at midnight in the tank&#39;s location, but the graph labels are in the viewer&#39;s time zone.</p>
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>

<p><canvas id="storage-tank" width="600" height="400"></canvas></p>
<script type="text/javascript">
// Generate fictitious "data"
const start = Temporal.now.absolute().minus({ hours: 24 });
const blank = Array(24 * 12);
const tankDataX = Array.from(blank, (_, ix) => start.plus({ minutes: ix * 5 }));
const tankDataY = Array.from(blank);
tankDataY[0] = 25;
for (let ix = 1; ix < tankDataY.length; ix++) {
  tankDataY[ix] = Math.max(0, tankDataY[ix - 1] + 3 * (Math.random() - 0.5));
}

// tankDataX and tankDataY are X and Y-axis data for the last 24 hours,
// obtained from elsewhere, e.g. const [tankDataX, tankDataY] = fetchData();
// tankDataX is an array of Temporal.Absolute, and tankDataY is an array of numbers.

// Show data starting from the most recent midnight in the tank's location (Stockholm)
const tankTimeZone = Temporal.TimeZone.from('Europe/Stockholm');
const tankMidnight = Temporal.now
  .absolute()
  .inTimeZone(tankTimeZone)
  .getDate()
  .withTime(Temporal.Time.from('00:00'))
  .inTimeZone(tankTimeZone);
const atOrAfterMidnight = (x) => Temporal.Absolute.compare(x, tankMidnight) >= 0;
const dataStartIndex = tankDataX.findIndex(atOrAfterMidnight);
const labelFormatter = new Intl.DateTimeFormat(undefined, {
  weekday: 'short',
  hour: 'numeric',
  minute: 'numeric',
  timeZone: Temporal.now.timeZone()
});
const graphLabels = tankDataX.slice(dataStartIndex).map((x) => labelFormatter.format(x));
const graphPoints = tankDataY.slice(dataStartIndex);

const ctx = document.getElementById('storage-tank').getContext('2d');
// The graph is made with Chart.js (https://www.chartjs.org/)
new Chart(ctx, {
  type: 'line',
  data: {
    labels: graphLabels,
    datasets: [
      {
        label: 'Fill level',
        data: graphPoints
      }
    ]
  },
  options: {
    title: {
      display: true,
      text: 'Stockholm storage tank'
    },
    scales: {
      yAxes: [
        {
          ticks: {
            beginAtZero: true
          }
        }
      ]
    }
  }
});

</script>

<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// tankDataX and tankDataY are X and Y-axis data for the last 24 hours,</span>
<span class="token comment">// obtained from elsewhere, e.g. const [tankDataX, tankDataY] = fetchData();</span>
<span class="token comment">// tankDataX is an array of Temporal.Absolute, and tankDataY is an array of numbers.</span>

<span class="token comment">// Show data starting from the most recent midnight in the tank's location (Stockholm)</span>
<span class="token keyword">const</span> tankTimeZone <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>TimeZone<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'Europe/Stockholm'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> tankMidnight <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>now
  <span class="token punctuation">.</span><span class="token function">absolute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">inTimeZone</span><span class="token punctuation">(</span>tankTimeZone<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">withTime</span><span class="token punctuation">(</span>Temporal<span class="token punctuation">.</span>Time<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'00:00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">inTimeZone</span><span class="token punctuation">(</span>tankTimeZone<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">atOrAfterMidnight</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token operator">=></span> Temporal<span class="token punctuation">.</span>Absolute<span class="token punctuation">.</span><span class="token function">compare</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> tankMidnight<span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> dataStartIndex <span class="token operator">=</span> tankDataX<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span>atOrAfterMidnight<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> labelFormatter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intl<span class="token punctuation">.</span>DateTimeFormat</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  weekday<span class="token operator">:</span> <span class="token string">'short'</span><span class="token punctuation">,</span>
  hour<span class="token operator">:</span> <span class="token string">'numeric'</span><span class="token punctuation">,</span>
  minute<span class="token operator">:</span> <span class="token string">'numeric'</span><span class="token punctuation">,</span>
  timeZone<span class="token operator">:</span> Temporal<span class="token punctuation">.</span>now<span class="token punctuation">.</span><span class="token function">timeZone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> graphLabels <span class="token operator">=</span> tankDataX<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>dataStartIndex<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token operator">=></span> labelFormatter<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> graphPoints <span class="token operator">=</span> tankDataY<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>dataStartIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> ctx <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'storage-tank'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// The graph is made with Chart.js (https://www.chartjs.org/)</span>
<span class="token keyword">new</span> <span class="token class-name">Chart</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">'line'</span><span class="token punctuation">,</span>
  data<span class="token operator">:</span> <span class="token punctuation">{</span>
    labels<span class="token operator">:</span> graphLabels<span class="token punctuation">,</span>
    datasets<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        label<span class="token operator">:</span> <span class="token string">'Fill level'</span><span class="token punctuation">,</span>
        data<span class="token operator">:</span> graphPoints
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  options<span class="token operator">:</span> <span class="token punctuation">{</span>
    title<span class="token operator">:</span> <span class="token punctuation">{</span>
      display<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      text<span class="token operator">:</span> <span class="token string">'Stockholm storage tank'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    scales<span class="token operator">:</span> <span class="token punctuation">{</span>
      yAxes<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          ticks<span class="token operator">:</span> <span class="token punctuation">{</span>
            beginAtZero<span class="token operator">:</span> <span class="token boolean">true</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="book-a-meeting-across-time-zones"><a class="heading-link" href="#book-a-meeting-across-time-zones"></a>Book a meeting across time zones</h3><p>Across the web there are several tools for finding meeting times that are appropriate for all the participants&#39; time zones, such as <a href="https://www.worldtimebuddy.com/">World Time Buddy</a>, <a href="https://www.timeanddate.com/worldclock/meeting.html">World Clock Meeting Planner</a>, and built into various calendar software.</p>
<style>
  #meeting-planner {
    border-collapse: separate;
    border-spacing: 0 10px;
    font-size: 0.6rem;
    text-align: center;
  }

  /* https://materializecss.com/color.html */
  .time-0, .time-1, .time-2, .time-3, .time-4, .time-5,
  .time-22, .time-23 {
    background-color: #ef9a9a;  /* red lighten-3 */
    border-color: #e57373;  /* red lighten-2 */
    border-style: solid;
    border-width: 0 1px;
  }
  .time-6, .time-7, .time-18, .time-19, .time-20, .time-21 {
    background-color: #fff59d;  /* yellow lighten-3 */
    border-color: #ffd54f;  /* amber lighten-2 */
    border-style: solid;
    border-width: 0 1px;
  }
  .time-8, .time-9, .time-10, .time-11, .time-12, .time-13,
  .time-14, .time-15, .time-16, .time-17 {
    background-color: #a5d6a7;  /* green lighten-3 */
    border-color: #81c784;  /* green lighten-2 */
    border-style: solid;
    border-width: 0 1px;
  }

  .time-0 {
    border-bottom-left-radius: 12px;
    border-left-color: white;
    border-left-width: 2px;
    border-top-left-radius: 12px;
    font-weight: bold;
  }
  .time-23 {
    border-bottom-right-radius: 12px;
    border-right-color: white;
    border-right-width: 2px;
    border-top-right-radius: 12px;
  }

  .time-current {
    border: 2px solid black;
  }
</style>

<table id="meeting-planner">
</table>

<script type="text/javascript" id="meeting-planner-source">
// Display local time zone and three others
const here = Temporal.now.timeZone();
const now = Temporal.now.absolute();
const timeZones = [
  { name: 'Here', tz: here },
  { name: 'New York', tz: Temporal.TimeZone.from('America/New_York') },
  { name: 'London', tz: Temporal.TimeZone.from('Europe/London') },
  { name: 'Tokyo', tz: Temporal.TimeZone.from('Asia/Tokyo') }
];

// Start the table at midnight local time
const calendarNow = now.inTimeZone(here);
const startTime = calendarNow
  .getDate()
  .withTime(Temporal.Time.from('00:00')) // midnight
  .inTimeZone(here);

// Build the table
const table = document.getElementById('meeting-planner');
timeZones.forEach(({ name, tz }) => {
  const row = document.createElement('tr');

  const title = document.createElement('td');
  title.textContent = `${name} (UTC${tz.getOffsetStringFor(now)})`;
  row.appendChild(title);

  for (let hours = 0; hours < 24; hours++) {
    const cell = document.createElement('td');

    const dt = startTime.plus({ hours }).inTimeZone(tz);
    cell.className = `time-${dt.hour}`;

    // Highlight the current hour in each row
    if (hours === calendarNow.hour) cell.className += ' time-current';

    // Show the date in midnight cells
    let formatOptions;
    if (dt.hour === 0) {
      formatOptions = { month: 'short', day: 'numeric' };
    } else {
      formatOptions = { hour: 'numeric' };
    }
    cell.textContent = dt.toLocaleString(undefined, formatOptions);
    row.appendChild(cell);
  }

  table.appendChild(row);
});

</script>

<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// Display local time zone and three others</span>
<span class="token keyword">const</span> here <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>now<span class="token punctuation">.</span><span class="token function">timeZone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> now <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>now<span class="token punctuation">.</span><span class="token function">absolute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> timeZones <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Here'</span><span class="token punctuation">,</span> tz<span class="token operator">:</span> here <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'New York'</span><span class="token punctuation">,</span> tz<span class="token operator">:</span> Temporal<span class="token punctuation">.</span>TimeZone<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'America/New_York'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'London'</span><span class="token punctuation">,</span> tz<span class="token operator">:</span> Temporal<span class="token punctuation">.</span>TimeZone<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'Europe/London'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Tokyo'</span><span class="token punctuation">,</span> tz<span class="token operator">:</span> Temporal<span class="token punctuation">.</span>TimeZone<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'Asia/Tokyo'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// Start the table at midnight local time</span>
<span class="token keyword">const</span> calendarNow <span class="token operator">=</span> now<span class="token punctuation">.</span><span class="token function">inTimeZone</span><span class="token punctuation">(</span>here<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> startTime <span class="token operator">=</span> calendarNow
  <span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">withTime</span><span class="token punctuation">(</span>Temporal<span class="token punctuation">.</span>Time<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'00:00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// midnight</span>
  <span class="token punctuation">.</span><span class="token function">inTimeZone</span><span class="token punctuation">(</span>here<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Build the table</span>
<span class="token keyword">const</span> table <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'meeting-planner'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
timeZones<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> name<span class="token punctuation">,</span> tz <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> row <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'tr'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> title <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'td'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  title<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> (UTC</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>tz<span class="token punctuation">.</span><span class="token function">getOffsetStringFor</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  row<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> hours <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> hours <span class="token operator">&lt;</span> <span class="token number">24</span><span class="token punctuation">;</span> hours<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> cell <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'td'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> dt <span class="token operator">=</span> startTime<span class="token punctuation">.</span><span class="token function">plus</span><span class="token punctuation">(</span><span class="token punctuation">{</span> hours <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">inTimeZone</span><span class="token punctuation">(</span>tz<span class="token punctuation">)</span><span class="token punctuation">;</span>
    cell<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">time-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dt<span class="token punctuation">.</span>hour<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

    <span class="token comment">// Highlight the current hour in each row</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>hours <span class="token operator">===</span> calendarNow<span class="token punctuation">.</span>hour<span class="token punctuation">)</span> cell<span class="token punctuation">.</span>className <span class="token operator">+=</span> <span class="token string">' time-current'</span><span class="token punctuation">;</span>

    <span class="token comment">// Show the date in midnight cells</span>
    <span class="token keyword">let</span> formatOptions<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>dt<span class="token punctuation">.</span>hour <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      formatOptions <span class="token operator">=</span> <span class="token punctuation">{</span> month<span class="token operator">:</span> <span class="token string">'short'</span><span class="token punctuation">,</span> day<span class="token operator">:</span> <span class="token string">'numeric'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      formatOptions <span class="token operator">=</span> <span class="token punctuation">{</span> hour<span class="token operator">:</span> <span class="token string">'numeric'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    cell<span class="token punctuation">.</span>textContent <span class="token operator">=</span> dt<span class="token punctuation">.</span><span class="token function">toLocaleString</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span> formatOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
    row<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>cell<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  table<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h2 id="arithmetic-1">Arithmetic</h2>
<h3 id="how-many-days-until-a-future-date"><a class="heading-link" href="#how-many-days-until-a-future-date"></a>How many days until a future date</h3><p>An example HTML form inspired by <a href="https://www.timeanddate.com/date/durationresult.html">Days Calculator</a> on timeanddate.com:</p>
<form action="#how-many-days-until-a-future-date">
  <label>
    Enter future date:
    <input type="date" name="futuredate">
  </label>
  <button>Submit</button>
</form>

<div id="futuredate-results"></div>

<script type="text/javascript">
{
  // Do initialization that doesn't necessarily need to be included in
  // the example; see 'Calendar input element'
  const futureDatePicker = document.querySelector('input[name="futuredate"]');
  const today = Temporal.now.date();
  futureDatePicker.min = today;
  futureDatePicker.value = today.plus({ months: 1 });
}
// Form parameters
const params = new URL(document.location).searchParams;
const futuredateParam = params.get('futuredate');

// If you have Intl.DurationFormat, then you can do this with
// until.toLocaleString() and untilMonths.toLocaleString(). This
// example will be updated when that becomes possible. For now, we can
// generate the string only in English.
function englishPlural(n, singular, plural) {
  return `${n} ${n === 1 ? singular : plural}`;
}

// When form data posted:
if (futuredateParam !== null) {
  const futureDate = Temporal.Date.from(futuredateParam);
  const today = Temporal.now.date();
  const until = today.difference(futureDate, { largestUnit: 'days' });
  const untilMonths = today.difference(futureDate, { largestUnit: 'months' });

  const dayString = englishPlural(until.days, 'day', 'days');
  const monthString =
    `${englishPlural(untilMonths.months, 'month', 'months')}` +
    (untilMonths.days !== 0 ? `, ${englishPlural(untilMonths.days, 'day', 'days')}` : '');

  const results = document.getElementById('futuredate-results');
  results.innerHTML = `
    <p>From and including: <strong>${today.toLocaleString()}</strong></p>
    <p>To but not including: <strong>${futureDate.toLocaleString()}</strong></p>
    <h4>Result: ${dayString}</h4>
    <p>It is ${dayString} from the start date to the end date, but not
    including the end date.</p>
    <p>Or ${monthString} excluding the end date.</p>
  `;
}

</script>

<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// Form parameters</span>
<span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>location<span class="token punctuation">)</span><span class="token punctuation">.</span>searchParams<span class="token punctuation">;</span>
<span class="token keyword">const</span> futuredateParam <span class="token operator">=</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'futuredate'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// If you have Intl.DurationFormat, then you can do this with</span>
<span class="token comment">// until.toLocaleString() and untilMonths.toLocaleString(). This</span>
<span class="token comment">// example will be updated when that becomes possible. For now, we can</span>
<span class="token comment">// generate the string only in English.</span>
<span class="token keyword">function</span> <span class="token function">englishPlural</span><span class="token punctuation">(</span><span class="token parameter">n<span class="token punctuation">,</span> singular<span class="token punctuation">,</span> plural</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>n<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>n <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">?</span> singular <span class="token operator">:</span> plural<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// When form data posted:</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>futuredateParam <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> futureDate <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Date<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>futuredateParam<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> today <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>now<span class="token punctuation">.</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> until <span class="token operator">=</span> today<span class="token punctuation">.</span><span class="token function">difference</span><span class="token punctuation">(</span>futureDate<span class="token punctuation">,</span> <span class="token punctuation">{</span> largestUnit<span class="token operator">:</span> <span class="token string">'days'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> untilMonths <span class="token operator">=</span> today<span class="token punctuation">.</span><span class="token function">difference</span><span class="token punctuation">(</span>futureDate<span class="token punctuation">,</span> <span class="token punctuation">{</span> largestUnit<span class="token operator">:</span> <span class="token string">'months'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> dayString <span class="token operator">=</span> <span class="token function">englishPlural</span><span class="token punctuation">(</span>until<span class="token punctuation">.</span>days<span class="token punctuation">,</span> <span class="token string">'day'</span><span class="token punctuation">,</span> <span class="token string">'days'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> monthString <span class="token operator">=</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">englishPlural</span><span class="token punctuation">(</span>untilMonths<span class="token punctuation">.</span>months<span class="token punctuation">,</span> <span class="token string">'month'</span><span class="token punctuation">,</span> <span class="token string">'months'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
    <span class="token punctuation">(</span>untilMonths<span class="token punctuation">.</span>days <span class="token operator">!==</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">englishPlural</span><span class="token punctuation">(</span>untilMonths<span class="token punctuation">.</span>days<span class="token punctuation">,</span> <span class="token string">'day'</span><span class="token punctuation">,</span> <span class="token string">'days'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> results <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'futuredate-results'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  results<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    &lt;p>From and including: &lt;strong></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>today<span class="token punctuation">.</span><span class="token function">toLocaleString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/strong>&lt;/p>
    &lt;p>To but not including: &lt;strong></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>futureDate<span class="token punctuation">.</span><span class="token function">toLocaleString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/strong>&lt;/p>
    &lt;h4>Result: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dayString<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/h4>
    &lt;p>It is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dayString<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> from the start date to the end date, but not
    including the end date.&lt;/p>
    &lt;p>Or </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>monthString<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> excluding the end date.&lt;/p>
  </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="unit-constrained-duration-between-now-and-a-pastfuture-zoned-event"><a class="heading-link" href="#unit-constrained-duration-between-now-and-a-pastfuture-zoned-event"></a>Unit-constrained duration between now and a past/future zoned event</h3><p>Map two Temporal.Absolute instances into an ascending/descending order indicator and a Temporal.Duration instance representing the duration between the two instants without using units coarser than specified (e.g., for presenting a meaningful countdown with vs. without using months or days).</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">/**
 * @typedef {Object} ElapsedDuration
 * @property {string} return.sign - "+" or "-"
 * @property {Temporal.Duration} return.duration - Elapsed duration
 */</span>
<span class="token comment">/**
 * Compute the difference between two instants, suitable for use in a countdown,
 * for example.
 *
 * @param {Temporal.Absolute} then - Instant since when to measure the duration
 * @param {Temporal.Absolute} now - Instant until when to measure the duration
 * @param {string} [largestUnit=days] - Largest time unit to have in the result
 * @returns {ElapsedDuration} Time between `then` and `now`
 */</span>
<span class="token keyword">function</span> <span class="token function">getElapsedDurationSinceInstant</span><span class="token punctuation">(</span>then<span class="token punctuation">,</span> now<span class="token punctuation">,</span> largestUnit <span class="token operator">=</span> <span class="token string">'days'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> sign <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Absolute<span class="token punctuation">.</span><span class="token function">compare</span><span class="token punctuation">(</span>now<span class="token punctuation">,</span> then<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token string">'-'</span> <span class="token operator">:</span> <span class="token string">'+'</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> duration <span class="token operator">=</span> now<span class="token punctuation">.</span><span class="token function">difference</span><span class="token punctuation">(</span>then<span class="token punctuation">,</span> <span class="token punctuation">{</span> largestUnit <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> sign<span class="token punctuation">,</span> duration <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">getElapsedDurationSinceInstant</span><span class="token punctuation">(</span>
  Temporal<span class="token punctuation">.</span>Absolute<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'2020-01-09T00:00Z'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  Temporal<span class="token punctuation">.</span>Absolute<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'2020-01-09T04:00Z'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>result<span class="token punctuation">.</span>sign<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>result<span class="token punctuation">.</span>duration<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token string">'+PT4H'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> result2 <span class="token operator">=</span> <span class="token function">getElapsedDurationSinceInstant</span><span class="token punctuation">(</span>
  Temporal<span class="token punctuation">.</span>Absolute<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'2020-01-09T04:00Z'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  Temporal<span class="token punctuation">.</span>Absolute<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'2020-01-09T00:00Z'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token string">'minutes'</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>result2<span class="token punctuation">.</span>sign<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>result2<span class="token punctuation">.</span>duration<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token string">'-PT240M'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Example of using it in a countdown:</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> sign<span class="token punctuation">,</span> duration <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">getElapsedDurationSinceInstant</span><span class="token punctuation">(</span>
  Temporal<span class="token punctuation">.</span>Absolute<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'2020-04-01T13:00-07:00[America/Los_Angeles]'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  Temporal<span class="token punctuation">.</span>now<span class="token punctuation">.</span><span class="token function">absolute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">It's </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>duration<span class="token punctuation">.</span><span class="token function">toLocaleString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sign <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token string">'until'</span> <span class="token operator">:</span> <span class="token string">'since'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> the TC39 Temporal presentation</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
</code></pre><h3 id="nearest-offset-transition-in-a-time-zone"><a class="heading-link" href="#nearest-offset-transition-in-a-time-zone"></a>Nearest offset transition in a time zone</h3><p>Map a Temporal.Absolute instance and a Temporal.TimeZone object into a Temporal.Absolute instance representing the nearest following instant at which there is an offset transition in the time zone (e.g., for setting reminders).</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">/**
 * Get the nearest following instant that the given time zone transitions to
 * another UTC offset, inclusive or exclusive.
 *
 * @param {Temporal.Absolute} absolute - Start time to consider
 * @param {Temporal.TimeZone} timeZone - Time zone to consider
 * @param {boolean} inclusive - Include the start time, or not
 * @returns {(Temporal.Absolute|null)} - Next UTC offset transition, or null if
 *   none known at this time
 */</span>
<span class="token keyword">function</span> <span class="token function">getInstantOfNearestOffsetTransitionToInstant</span><span class="token punctuation">(</span><span class="token parameter">absolute<span class="token punctuation">,</span> timeZone<span class="token punctuation">,</span> inclusive</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> nearest<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>inclusive<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// In case absolute itself is the moment of a transition:</span>
    <span class="token punctuation">[</span>nearest<span class="token punctuation">]</span> <span class="token operator">=</span> timeZone<span class="token punctuation">.</span><span class="token function">getTransitions</span><span class="token punctuation">(</span>absolute<span class="token punctuation">.</span><span class="token function">minus</span><span class="token punctuation">(</span><span class="token punctuation">{</span> nanoseconds<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token punctuation">[</span>nearest<span class="token punctuation">]</span> <span class="token operator">=</span> timeZone<span class="token punctuation">.</span><span class="token function">getTransitions</span><span class="token punctuation">(</span>absolute<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> nearest<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> absolute <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Absolute<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'2019-04-16T21:01Z'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> nyc <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>TimeZone<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'America/New_York'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> nextTransition <span class="token operator">=</span> <span class="token function">getInstantOfNearestOffsetTransitionToInstant</span><span class="token punctuation">(</span>absolute<span class="token punctuation">,</span> nyc<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>nextTransition<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'2019-11-03T06:00Z'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Inclusive</span>
<span class="token keyword">const</span> sameTransition <span class="token operator">=</span> <span class="token function">getInstantOfNearestOffsetTransitionToInstant</span><span class="token punctuation">(</span>nextTransition<span class="token punctuation">,</span> nyc<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>sameTransition<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nextTransition<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// No known future DST transitions in a time zone</span>
<span class="token keyword">const</span> regina <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>TimeZone<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'America/Regina'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token function">getInstantOfNearestOffsetTransitionToInstant</span><span class="token punctuation">(</span>absolute<span class="token punctuation">,</span> regina<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="comparison-of-an-instant-to-business-hours"><a class="heading-link" href="#comparison-of-an-instant-to-business-hours"></a>Comparison of an instant to business hours</h3><p>This example takes a roster of opening and closing times for a business, and maps a localized date and time of day into a time-sensitive state indicator (&quot;opening soon&quot; vs. &quot;open&quot; vs. &quot;closing soon&quot; vs. &quot;closed&quot;).</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">/**
 * Compare the given time to the business hours of a business located in a
 * particular time zone, and return a string indicating whether the business is
 * open, closed, opening soon, or closing soon. The length of "soon" can be
 * controlled using the `soonWindow` parameter.
 *
 * @param {Temporal.Absolute} now - Time at which to consider whether the
 *  business is open
 * @param {Temporal.TimeZone} timeZone - Time zone in which the business is
 *  located
 * @param {(Object|null)[]} businessHours - Array of length 7 indicating
 *  business hours during the week
 * @param {Temporal.Time} businessHours[].open - Time at which the business
 *  opens
 * @param {Temporal.Time} businessHours[].close - Time at which the business
 *  closes
 * @param {Temporal.Duration} soonWindow - Length of time before the opening or
 *  closing time during which the business should be considered "opening soon"
 *  or "closing soon"
 * @returns {string} "open", "closed", "opening soon", or "closing soon"
 */</span>
<span class="token keyword">function</span> <span class="token function">getBusinessOpenStateText</span><span class="token punctuation">(</span><span class="token parameter">now<span class="token punctuation">,</span> timeZone<span class="token punctuation">,</span> businessHours<span class="token punctuation">,</span> soonWindow</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">inRange</span><span class="token punctuation">(</span><span class="token parameter">dateTime<span class="token punctuation">,</span> start<span class="token punctuation">,</span> end</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Temporal<span class="token punctuation">.</span>DateTime<span class="token punctuation">.</span><span class="token function">compare</span><span class="token punctuation">(</span>dateTime<span class="token punctuation">,</span> start<span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> Temporal<span class="token punctuation">.</span>DateTime<span class="token punctuation">.</span><span class="token function">compare</span><span class="token punctuation">(</span>dateTime<span class="token punctuation">,</span> end<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> dateTime <span class="token operator">=</span> now<span class="token punctuation">.</span><span class="token function">inTimeZone</span><span class="token punctuation">(</span>timeZone<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> weekday <span class="token operator">=</span> dateTime<span class="token punctuation">.</span>dayOfWeek <span class="token operator">%</span> <span class="token number">7</span><span class="token punctuation">;</span> <span class="token comment">// convert to 0-based, for array indexing</span>

  <span class="token comment">// Because of times wrapping around at midnight, we may need to consider</span>
  <span class="token comment">// yesterday's and tomorrow's hours as well</span>
  <span class="token keyword">const</span> today <span class="token operator">=</span> dateTime<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> yesterday <span class="token operator">=</span> today<span class="token punctuation">.</span><span class="token function">minus</span><span class="token punctuation">(</span><span class="token punctuation">{</span> days<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> tomorrow <span class="token operator">=</span> today<span class="token punctuation">.</span><span class="token function">plus</span><span class="token punctuation">(</span><span class="token punctuation">{</span> days<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Push any of the businessHours that overlap today's date into an array,</span>
  <span class="token comment">// that we will subsequently check. Convert the businessHours Times into</span>
  <span class="token comment">// DateTimes so that they no longer wrap around.</span>
  <span class="token keyword">const</span> businessHoursOverlappingToday <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> yesterdayHours <span class="token operator">=</span> businessHours<span class="token punctuation">[</span><span class="token punctuation">(</span>weekday <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>yesterdayHours<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> open<span class="token punctuation">,</span> close <span class="token punctuation">}</span> <span class="token operator">=</span> yesterdayHours<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Temporal<span class="token punctuation">.</span>Time<span class="token punctuation">.</span><span class="token function">compare</span><span class="token punctuation">(</span>close<span class="token punctuation">,</span> open<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      businessHoursOverlappingToday<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        open<span class="token operator">:</span> yesterday<span class="token punctuation">.</span><span class="token function">withTime</span><span class="token punctuation">(</span>open<span class="token punctuation">)</span><span class="token punctuation">,</span>
        close<span class="token operator">:</span> today<span class="token punctuation">.</span><span class="token function">withTime</span><span class="token punctuation">(</span>close<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> todayHours <span class="token operator">=</span> businessHours<span class="token punctuation">[</span>weekday<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>todayHours<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> open<span class="token punctuation">,</span> close <span class="token punctuation">}</span> <span class="token operator">=</span> todayHours<span class="token punctuation">;</span>
    businessHoursOverlappingToday<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      open<span class="token operator">:</span> today<span class="token punctuation">.</span><span class="token function">withTime</span><span class="token punctuation">(</span>open<span class="token punctuation">)</span><span class="token punctuation">,</span>
      close<span class="token operator">:</span> <span class="token punctuation">(</span>Temporal<span class="token punctuation">.</span>Time<span class="token punctuation">.</span><span class="token function">compare</span><span class="token punctuation">(</span>close<span class="token punctuation">,</span> open<span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">0</span> <span class="token operator">?</span> today <span class="token operator">:</span> tomorrow<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withTime</span><span class="token punctuation">(</span>close<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Check if any of the candidate business hours include the given time</span>
  <span class="token keyword">const</span> soon <span class="token operator">=</span> dateTime<span class="token punctuation">.</span><span class="token function">plus</span><span class="token punctuation">(</span>soonWindow<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> openNow <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> openSoon <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">{</span> open<span class="token punctuation">,</span> close <span class="token punctuation">}</span> <span class="token keyword">of</span> businessHoursOverlappingToday<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    openNow <span class="token operator">=</span> openNow <span class="token operator">||</span> <span class="token function">inRange</span><span class="token punctuation">(</span>dateTime<span class="token punctuation">,</span> open<span class="token punctuation">,</span> close<span class="token punctuation">)</span><span class="token punctuation">;</span>
    openSoon <span class="token operator">=</span> openSoon <span class="token operator">||</span> <span class="token function">inRange</span><span class="token punctuation">(</span>soon<span class="token punctuation">,</span> open<span class="token punctuation">,</span> close<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>openNow<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>openSoon<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">'closing soon'</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">'open'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>openSoon<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">'opening soon'</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token string">'closed'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// For example, a restaurant or bar might have opening hours that go past</span>
<span class="token comment">// midnight; make sure this is handled correctly</span>
<span class="token keyword">const</span> businessHours <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token comment">/* Sun */</span> <span class="token punctuation">{</span> open<span class="token operator">:</span> Temporal<span class="token punctuation">.</span>Time<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'13:00'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> close<span class="token operator">:</span> Temporal<span class="token punctuation">.</span>Time<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'20:30'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">/* Mon */</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// closed Mondays</span>
  <span class="token comment">/* Tue */</span> <span class="token punctuation">{</span> open<span class="token operator">:</span> Temporal<span class="token punctuation">.</span>Time<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'11:00'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> close<span class="token operator">:</span> Temporal<span class="token punctuation">.</span>Time<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'20:30'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">/* Wed */</span> <span class="token punctuation">{</span> open<span class="token operator">:</span> Temporal<span class="token punctuation">.</span>Time<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'11:00'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> close<span class="token operator">:</span> Temporal<span class="token punctuation">.</span>Time<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'20:30'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">/* Thu */</span> <span class="token punctuation">{</span> open<span class="token operator">:</span> Temporal<span class="token punctuation">.</span>Time<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'11:00'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> close<span class="token operator">:</span> Temporal<span class="token punctuation">.</span>Time<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'22:00'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">/* Fri */</span> <span class="token punctuation">{</span> open<span class="token operator">:</span> Temporal<span class="token punctuation">.</span>Time<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'11:00'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> close<span class="token operator">:</span> Temporal<span class="token punctuation">.</span>Time<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'00:00'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">/* Sat */</span> <span class="token punctuation">{</span> open<span class="token operator">:</span> Temporal<span class="token punctuation">.</span>Time<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'11:00'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> close<span class="token operator">:</span> Temporal<span class="token punctuation">.</span>Time<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'02:00'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> now <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Absolute<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'2019-04-07T00:00+01:00[Europe/Berlin]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> tz <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>TimeZone<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'Europe/Berlin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> soonWindow <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Duration<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> minutes<span class="token operator">:</span> <span class="token number">30</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> saturdayNightState <span class="token operator">=</span> <span class="token function">getBusinessOpenStateText</span><span class="token punctuation">(</span>now<span class="token punctuation">,</span> tz<span class="token punctuation">,</span> businessHours<span class="token punctuation">,</span> soonWindow<span class="token punctuation">)</span><span class="token punctuation">;</span>
assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>saturdayNightState<span class="token punctuation">,</span> <span class="token string">'open'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="flight-arrivaldepartureduration"><a class="heading-link" href="#flight-arrivaldepartureduration"></a>Flight arrival/departure/duration</h3><p>Map localized trip departure and arrival times into trip duration in units no larger than hours.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">/**
 * Given localized departure and arrival times, get a trip duration suitable
 * for display in an airline ticket website, for example.
 *
 * @param {string} parseableDeparture - Departure time with time zone
 * @param {string} parseableArrival - Arrival time with time zone
 * @returns {Temporal.Duration} A duration with units no larger than hours
 */</span>
<span class="token keyword">function</span> <span class="token function">getTripDurationInHrMinSec</span><span class="token punctuation">(</span><span class="token parameter">parseableDeparture<span class="token punctuation">,</span> parseableArrival</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> departure <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Absolute<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>parseableDeparture<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> arrival <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Absolute<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>parseableArrival<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> departure<span class="token punctuation">.</span><span class="token function">difference</span><span class="token punctuation">(</span>arrival<span class="token punctuation">,</span> <span class="token punctuation">{</span> largestUnit<span class="token operator">:</span> <span class="token string">'hours'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> flightTime <span class="token operator">=</span> <span class="token function">getTripDurationInHrMinSec</span><span class="token punctuation">(</span>
  <span class="token string">'2020-03-08T11:55:00+08:00[Asia/Hong_Kong]'</span><span class="token punctuation">,</span>
  <span class="token string">'2020-03-08T09:50:00-07:00[America/Los_Angeles]'</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>flightTime<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'PT12H55M'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>Map localized departure time and duration into localized arrival time.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">/**
 * Given a localized departure time and a flight duration, get a local arrival
 * time in the destination time zone.
 *
 * @param {string} parseableDeparture - Departure time with time zone
 * @param {Temporal.Duration} flightTime - Duration of the flight
 * @param {Temporal.TimeZone} destinationTimeZone - Time zone in which the
 *  flight's destination is located
 * @returns {Temporal.DateTime} Local arrival time
 */</span>
<span class="token keyword">function</span> <span class="token function">getLocalizedArrival</span><span class="token punctuation">(</span><span class="token parameter">parseableDeparture<span class="token punctuation">,</span> flightTime<span class="token punctuation">,</span> destinationTimeZone</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> departure <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Absolute<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>parseableDeparture<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> arrival <span class="token operator">=</span> departure<span class="token punctuation">.</span><span class="token function">plus</span><span class="token punctuation">(</span>flightTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> arrival<span class="token punctuation">.</span><span class="token function">inTimeZone</span><span class="token punctuation">(</span>destinationTimeZone<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> arrival <span class="token operator">=</span> <span class="token function">getLocalizedArrival</span><span class="token punctuation">(</span>
  <span class="token string">'2020-03-08T11:55:00+08:00[Asia/Hong_Kong]'</span><span class="token punctuation">,</span>
  Temporal<span class="token punctuation">.</span>Duration<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> minutes<span class="token operator">:</span> <span class="token number">775</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token string">'America/Los_Angeles'</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>arrival<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'2020-03-08T09:50'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="push-back-a-launch-date"><a class="heading-link" href="#push-back-a-launch-date"></a>Push back a launch date</h3><p>Add the number of days it took to get an approval, and advance to the start of the following month.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">/**
 * Take a date, add a number of days' delay, and round to the start of the next
 * month.
 *
 * @param {Temporal.Date} date - Original date
 * @param {number} delayDays - Number of days' delay
 * @returns {Temporal.Date} - Beginning of the next month after the delay
 */</span>
<span class="token keyword">function</span> <span class="token function">plusAndRoundToMonthStart</span><span class="token punctuation">(</span><span class="token parameter">date<span class="token punctuation">,</span> delayDays</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> delayedDate <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">plus</span><span class="token punctuation">(</span><span class="token punctuation">{</span> days<span class="token operator">:</span> delayDays <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> month <span class="token operator">=</span> delayedDate<span class="token punctuation">.</span>month <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> delayedDate<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span><span class="token punctuation">{</span> month<span class="token punctuation">,</span> day<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> disambiguation<span class="token operator">:</span> <span class="token string">'balance'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> oldLaunchDate <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Date<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'2019-06-01'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> fifteenDaysDelay <span class="token operator">=</span> <span class="token function">plusAndRoundToMonthStart</span><span class="token punctuation">(</span>oldLaunchDate<span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>fifteenDaysDelay<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'2019-07-01'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> sixtyDaysDelay <span class="token operator">=</span> <span class="token function">plusAndRoundToMonthStart</span><span class="token punctuation">(</span>oldLaunchDate<span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>sixtyDaysDelay<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'2019-08-01'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="schedule-a-reminder-ahead-of-matching-a-record-setting-duration"><a class="heading-link" href="#schedule-a-reminder-ahead-of-matching-a-record-setting-duration"></a>Schedule a reminder ahead of matching a record-setting duration</h3><p>When considering a record (for example, a personal-best time in a sport), you might want to receive an alert just before the record is about to be broken.
This example takes a record as a <code>Temporal.Duration</code>, the starting instant of the current attempt as a <code>Temporal.Absolute</code>, and another <code>Temporal.Duration</code> indicating how long before the potentially record-setting instant you would like to receive an alert.
It returns the instant at which a notification could be sent, for example &quot;Keep going! 5 more minutes and it will be your personal best!&quot;</p>
<p>This could be used for workout tracking, racing (including <em>long</em> and potentially time-zone-crossing races like the Bullrun Rally, Iditarod, Self-Transcendence 3100, and Clipper Round The World), or even open-ended analogs like event-every-day &quot;streaks&quot;.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">/**
 * Retrieve a time at which to give advance notice of a record that is
 * potentially about to be broken.
 *
 * @param {Temporal.Absolute} start - Start time of the event
 * @param {Temporal.Duration} previousRecord - Existing record to be broken
 * @param {Temporal.Duration} noticeWindow - Advance notice time
 * @returns {Temporal.Absolute} Time at which to give advance notice of breaking
 *  the record
 */</span>
<span class="token keyword">function</span> <span class="token function">getInstantBeforeOldRecord</span><span class="token punctuation">(</span><span class="token parameter">start<span class="token punctuation">,</span> previousRecord<span class="token punctuation">,</span> noticeWindow</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> start<span class="token punctuation">.</span><span class="token function">plus</span><span class="token punctuation">(</span>previousRecord<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">minus</span><span class="token punctuation">(</span>noticeWindow<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Start of the men's 10000 meters at the Rio de Janeiro 2016 Olympic Games</span>
<span class="token keyword">const</span> raceStart <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Absolute<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'2016-08-13T21:27-03:00[America/Sao_Paulo]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Kenenisa Bekele's world record set in 2005</span>
<span class="token keyword">const</span> record <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Duration<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> minutes<span class="token operator">:</span> <span class="token number">26</span><span class="token punctuation">,</span> seconds<span class="token operator">:</span> <span class="token number">17</span><span class="token punctuation">,</span> milliseconds<span class="token operator">:</span> <span class="token number">530</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> noticeWindow <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Duration<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> minutes<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Time to send a "hurry up, can you finish the race in 1 minute?" push</span>
<span class="token comment">// notification to all the runners</span>
<span class="token keyword">const</span> reminderAt <span class="token operator">=</span> <span class="token function">getInstantBeforeOldRecord</span><span class="token punctuation">(</span>raceStart<span class="token punctuation">,</span> record<span class="token punctuation">,</span> noticeWindow<span class="token punctuation">)</span><span class="token punctuation">;</span>

assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>reminderAt<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'2016-08-14T00:52:17.530Z'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="nth-weekday-of-the-month"><a class="heading-link" href="#nth-weekday-of-the-month"></a>Nth weekday of the month</h3><p>Example of getting a <code>Temporal.Date</code> representing the first Tuesday of the given <code>Temporal.YearMonth</code>, adaptable to other weekdays.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">/**
 * Gets the first Tuesday of the month and returns its date
 *
 * @param {Temporal.YearMonth} queriedMonth - YearMonth instance to query
 * @returns {Temporal.Date} Temporal.Date Instance which gives first tuesday
 */</span>
<span class="token keyword">function</span> <span class="token function">getFirstTuesday</span><span class="token punctuation">(</span><span class="token parameter">queriedMonth</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// We first need to convert to a date</span>
  <span class="token keyword">const</span> firstOfMonth <span class="token operator">=</span> queriedMonth<span class="token punctuation">.</span><span class="token function">withDay</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// We have Monday = 1, Sunday = 7, and we want to add a positive number</span>
  <span class="token comment">// smaller than 7 to get to the first Tuesday.</span>
  <span class="token comment">// If we're already on a Tuesday (2) then we want to add 0.</span>
  <span class="token comment">// So for the first of the month being a Monday through Sunday the additions are:</span>
  <span class="token comment">//    1, 0, 6, 5, 4, 3, 2 which is given by that formula.</span>
  <span class="token comment">// This lookup table makes this example easier to read, but you can also</span>
  <span class="token comment">// calculate the answer: (7 + desiredWeekday - firstOfMonth.dayOfWeek) % 7</span>
  <span class="token keyword">return</span> firstOfMonth<span class="token punctuation">.</span><span class="token function">plus</span><span class="token punctuation">(</span><span class="token punctuation">{</span> days<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span>firstOfMonth<span class="token punctuation">.</span>dayOfWeek <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> myMonth <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>YearMonth<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'2020-02'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> firstTuesdayOfMonth <span class="token operator">=</span> <span class="token function">getFirstTuesday</span><span class="token punctuation">(</span>myMonth<span class="token punctuation">)</span><span class="token punctuation">;</span>
assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>firstTuesdayOfMonth<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'2020-02-04'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>firstTuesdayOfMonth<span class="token punctuation">.</span>dayOfWeek<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Similarly, to get the second Tuesday:</span>
<span class="token keyword">const</span> secondWeek <span class="token operator">=</span> myMonth<span class="token punctuation">.</span><span class="token function">withDay</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> secondTuesday <span class="token operator">=</span> secondWeek<span class="token punctuation">.</span><span class="token function">plus</span><span class="token punctuation">(</span><span class="token punctuation">{</span> days<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span>secondWeek<span class="token punctuation">.</span>dayOfWeek <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>secondTuesday<span class="token punctuation">.</span>day<span class="token punctuation">,</span> firstTuesdayOfMonth<span class="token punctuation">.</span>day <span class="token operator">+</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// And the last Tuesday:</span>
<span class="token keyword">const</span> lastOfMonth <span class="token operator">=</span> myMonth<span class="token punctuation">.</span><span class="token function">withDay</span><span class="token punctuation">(</span>myMonth<span class="token punctuation">.</span>daysInMonth<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> lastTuesday <span class="token operator">=</span> lastOfMonth<span class="token punctuation">.</span><span class="token function">minus</span><span class="token punctuation">(</span><span class="token punctuation">{</span> days<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">[</span>lastOfMonth<span class="token punctuation">.</span>dayOfWeek <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>lastTuesday<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'2020-02-25'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>lastTuesday<span class="token punctuation">.</span>dayOfWeek<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// or:</span>
<span class="token keyword">const</span> lastTuesday2 <span class="token operator">=</span> lastOfMonth<span class="token punctuation">.</span><span class="token function">minus</span><span class="token punctuation">(</span><span class="token punctuation">{</span> days<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token number">7</span> <span class="token operator">+</span> lastOfMonth<span class="token punctuation">.</span>dayOfWeek <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">7</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>Temporal<span class="token punctuation">.</span>Date<span class="token punctuation">.</span><span class="token function">compare</span><span class="token punctuation">(</span>lastTuesday<span class="token punctuation">,</span> lastTuesday2<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>Given a <code>Temporal.YearMonth</code> instance and an ISO 8601 ordinal calendar day of the week ranging from 1 (Monday) to 7 (Sunday), return a chronologically ordered array of <code>Temporal.Date</code> instances corresponding with every day in the month that is the specified day of the week (of which there will always be either four or five).</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">/**
 * Gets an array of Temporal.Dates of every day in the given month, that falls
 * on the given day of the week.
 *
 * @param {Temporal.YearMonth} yearMonth - Year and month to query
 * @param {number} dayNumberOfTheWeek - Day of the week, Monday=1, Sunday=7
 * @returns {Temporal.Date[]} Array of dates
 */</span>
<span class="token keyword">function</span> <span class="token function">getWeeklyDaysInMonth</span><span class="token punctuation">(</span><span class="token parameter">yearMonth<span class="token punctuation">,</span> dayNumberOfTheWeek</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> firstOfMonth <span class="token operator">=</span> yearMonth<span class="token punctuation">.</span><span class="token function">withDay</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> nextWeekday <span class="token operator">=</span> firstOfMonth<span class="token punctuation">.</span><span class="token function">plus</span><span class="token punctuation">(</span><span class="token punctuation">{</span> days<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token number">7</span> <span class="token operator">+</span> dayNumberOfTheWeek <span class="token operator">-</span> firstOfMonth<span class="token punctuation">.</span>dayOfWeek<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">7</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>nextWeekday<span class="token punctuation">.</span>month <span class="token operator">===</span> yearMonth<span class="token punctuation">.</span>month<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>nextWeekday<span class="token punctuation">)</span><span class="token punctuation">;</span>
    nextWeekday <span class="token operator">=</span> nextWeekday<span class="token punctuation">.</span><span class="token function">plus</span><span class="token punctuation">(</span><span class="token punctuation">{</span> days<span class="token operator">:</span> <span class="token number">7</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>
  <span class="token function">getWeeklyDaysInMonth</span><span class="token punctuation">(</span>Temporal<span class="token punctuation">.</span>YearMonth<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'2020-02'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token string">'2020-02-03 2020-02-10 2020-02-17 2020-02-24'</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>
  <span class="token function">getWeeklyDaysInMonth</span><span class="token punctuation">(</span>Temporal<span class="token punctuation">.</span>YearMonth<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'2020-02'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token string">'2020-02-01 2020-02-08 2020-02-15 2020-02-22 2020-02-29'</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>Given a <code>Temporal.Date</code> instance, return the count of preceding days in its month that share its day of the week.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">/**
 * Gets the number of preceding days in the same month as `date` that fall on
 * the same day of the week as `date`.
 *
 * @param {Temporal.Date} date - Starting date
 * @returns {number} Number of days
 */</span>
<span class="token keyword">function</span> <span class="token function">countPrecedingWeeklyDaysInMonth</span><span class="token punctuation">(</span><span class="token parameter">date</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// This doesn't actually require Temporal</span>
  <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token punctuation">(</span>date<span class="token punctuation">.</span>day <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token function">countPrecedingWeeklyDaysInMonth</span><span class="token punctuation">(</span>Temporal<span class="token punctuation">.</span>Date<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'2020-02-28'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token function">countPrecedingWeeklyDaysInMonth</span><span class="token punctuation">(</span>Temporal<span class="token punctuation">.</span>Date<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'2020-02-29'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="manipulating-the-day-of-the-month"><a class="heading-link" href="#manipulating-the-day-of-the-month"></a>Manipulating the day of the month</h3><p>Here are some examples of taking an existing date, and adjusting the day of the month.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> date <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Date<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'2020-04-14'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Third day of next month:</span>

<span class="token keyword">const</span> thirdOfNextMonth <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">plus</span><span class="token punctuation">(</span><span class="token punctuation">{</span> months<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span><span class="token punctuation">{</span> day<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>thirdOfNextMonth<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'2020-05-03'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Last day of this month:</span>

<span class="token keyword">const</span> lastOfThisMonth <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span><span class="token punctuation">{</span> day<span class="token operator">:</span> date<span class="token punctuation">.</span>daysInMonth <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>lastOfThisMonth<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'2020-04-30'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// On the 18th of this month at 8 PM:</span>

<span class="token keyword">const</span> thisMonth18thAt8PM <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span><span class="token punctuation">{</span> day<span class="token operator">:</span> <span class="token number">18</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withTime</span><span class="token punctuation">(</span>Temporal<span class="token punctuation">.</span>Time<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'20:00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>thisMonth18thAt8PM<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'2020-04-18T20:00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="same-date-in-another-month"><a class="heading-link" href="#same-date-in-another-month"></a>Same date in another month</h3><p>Likewise, here are some examples of taking an existing date and adjusting the month, but keeping the day and year the same.</p>
<p>Depending on the behaviour you want, you will need to pick the right <code>disambiguation</code> option, but the default of <code>&quot;constrain&quot;</code> should be correct for most cases.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> date <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Date<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'2020-05-31'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Same date and time, but in February</span>
<span class="token comment">// (and use the last day if the date doesn't exist in February):</span>

<span class="token keyword">const</span> feb <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span><span class="token punctuation">{</span> month<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>feb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'2020-02-29'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Same date and time, but in April</span>
<span class="token comment">// (and throw an exception if the date doesn't exist in April):</span>

assert<span class="token punctuation">.</span><span class="token function">throws</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  date<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span><span class="token punctuation">{</span> month<span class="token operator">:</span> <span class="token number">4</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> disambiguation<span class="token operator">:</span> <span class="token string">'reject'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="next-weekly-occurrence"><a class="heading-link" href="#next-weekly-occurrence"></a>Next weekly occurrence</h3><p>From a <code>Temporal.Absolute</code> instance and a local <code>Temporal.TimeZone</code>, get a <code>Temporal.DateTime</code> representing the next occurrence of a weekly event that is scheduled on a particular weekday and time in a particular time zone. (For example, &quot;weekly on Thursdays at 08:45 California time&quot;).</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">/**
 * Returns the local date and time for the next occurrence of a weekly occurring
 * event.
 *
 * @param {Temporal.Absolute} now - Starting point
 * @param {Temporal.TimeZone} localTimeZone - Time zone for return value
 * @param {number} weekday - Weekday event occurs on (Monday=1, Sunday=7)
 * @param {Temporal.Time} eventTime - Time event occurs at
 * @param {Temporal.TimeZone} eventTimeZone - Time zone where event is planned
 * @returns {Temporal.DateTime} Local date and time of next occurrence
 */</span>
<span class="token keyword">function</span> <span class="token function">nextWeeklyOccurrence</span><span class="token punctuation">(</span><span class="token parameter">now<span class="token punctuation">,</span> localTimeZone<span class="token punctuation">,</span> weekday<span class="token punctuation">,</span> eventTime<span class="token punctuation">,</span> eventTimeZone</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> dateTime <span class="token operator">=</span> now<span class="token punctuation">.</span><span class="token function">inTimeZone</span><span class="token punctuation">(</span>eventTimeZone<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> nextDate <span class="token operator">=</span> dateTime<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">plus</span><span class="token punctuation">(</span><span class="token punctuation">{</span> days<span class="token operator">:</span> <span class="token punctuation">(</span>weekday <span class="token operator">+</span> <span class="token number">7</span> <span class="token operator">-</span> dateTime<span class="token punctuation">.</span>dayOfWeek<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">7</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> nextOccurrence <span class="token operator">=</span> nextDate<span class="token punctuation">.</span><span class="token function">withTime</span><span class="token punctuation">(</span>eventTime<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Handle the case where the event is today but already happened</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Temporal<span class="token punctuation">.</span>DateTime<span class="token punctuation">.</span><span class="token function">compare</span><span class="token punctuation">(</span>dateTime<span class="token punctuation">,</span> nextOccurrence<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    nextOccurrence <span class="token operator">=</span> nextOccurrence<span class="token punctuation">.</span><span class="token function">plus</span><span class="token punctuation">(</span><span class="token punctuation">{</span> days<span class="token operator">:</span> <span class="token number">7</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> nextOccurrence<span class="token punctuation">.</span><span class="token function">inTimeZone</span><span class="token punctuation">(</span>eventTimeZone<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">inTimeZone</span><span class="token punctuation">(</span>localTimeZone<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// "Weekly on Thursdays at 08:45 California time":</span>
<span class="token keyword">const</span> weekday <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> eventTime <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Time<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'08:45'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> eventTimeZone <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>TimeZone<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'America/Los_Angeles'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> rightBefore <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Absolute<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'2020-03-26T08:30-07:00[America/Los_Angeles]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> localTimeZone <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>TimeZone<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'Europe/London'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> next <span class="token operator">=</span> <span class="token function">nextWeeklyOccurrence</span><span class="token punctuation">(</span>rightBefore<span class="token punctuation">,</span> localTimeZone<span class="token punctuation">,</span> weekday<span class="token punctuation">,</span> eventTime<span class="token punctuation">,</span> eventTimeZone<span class="token punctuation">)</span><span class="token punctuation">;</span>
assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>next<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'2020-03-26T15:45'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> rightAfter <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Absolute<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'2020-03-26T09:00-07:00[America/Los_Angeles]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
next <span class="token operator">=</span> <span class="token function">nextWeeklyOccurrence</span><span class="token punctuation">(</span>rightAfter<span class="token punctuation">,</span> localTimeZone<span class="token punctuation">,</span> weekday<span class="token punctuation">,</span> eventTime<span class="token punctuation">,</span> eventTimeZone<span class="token punctuation">)</span><span class="token punctuation">;</span>
assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>next<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'2020-04-02T16:45'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="weekday-of-yearly-occurrence"><a class="heading-link" href="#weekday-of-yearly-occurrence"></a>Weekday of yearly occurrence</h3><p>In some countries, when a public holiday falls on a Tuesday or Thursday, an extra &quot;bridge&quot; public holiday is observed on Monday or Friday in order to give workers a long weekend off.
The following example calculates this.</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">/**
 * Calculates the days that need to be taken off work in order to have a long
 * weekend around a public holiday, "bridging" the holiday if it falls on a
 * Tuesday or Thursday.
 *
 * @param {Temporal.MonthDay} holiday - Yearly date on the calendar
 * @param {number} year - Year in which to calculate the bridge days
 * @returns {Temporal.Date[]} List of dates to be taken off work
 */</span>
<span class="token keyword">function</span> <span class="token function">bridgePublicHolidays</span><span class="token punctuation">(</span><span class="token parameter">holiday<span class="token punctuation">,</span> year</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> date <span class="token operator">=</span> holiday<span class="token punctuation">.</span><span class="token function">withYear</span><span class="token punctuation">(</span>year<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>date<span class="token punctuation">.</span>dayOfWeek<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token comment">// Mon</span>
    <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span> <span class="token comment">// Wed</span>
    <span class="token keyword">case</span> <span class="token number">5</span><span class="token operator">:</span> <span class="token comment">// Fri</span>
      <span class="token keyword">return</span> <span class="token punctuation">[</span>date<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span> <span class="token comment">// Tue; take Monday off</span>
      <span class="token keyword">return</span> <span class="token punctuation">[</span>date<span class="token punctuation">.</span><span class="token function">minus</span><span class="token punctuation">(</span><span class="token punctuation">{</span> days<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> date<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span> <span class="token comment">// Thu; take Friday off</span>
      <span class="token keyword">return</span> <span class="token punctuation">[</span>date<span class="token punctuation">,</span> date<span class="token punctuation">.</span><span class="token function">plus</span><span class="token punctuation">(</span><span class="token punctuation">{</span> days<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">6</span><span class="token operator">:</span> <span class="token comment">// Sat</span>
    <span class="token keyword">case</span> <span class="token number">7</span><span class="token operator">:</span> <span class="token comment">// Sun</span>
      <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> labourDay <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>MonthDay<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'05-01'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// No bridge day</span>
assert<span class="token punctuation">.</span><span class="token function">deepEqual</span><span class="token punctuation">(</span>
  <span class="token function">bridgePublicHolidays</span><span class="token punctuation">(</span>labourDay<span class="token punctuation">,</span> <span class="token number">2020</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> d<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">'2020-05-01'</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Bridge day</span>
assert<span class="token punctuation">.</span><span class="token function">deepEqual</span><span class="token punctuation">(</span>
  <span class="token function">bridgePublicHolidays</span><span class="token punctuation">(</span>labourDay<span class="token punctuation">,</span> <span class="token number">2018</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> d<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">'2018-04-30'</span><span class="token punctuation">,</span> <span class="token string">'2018-05-01'</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Bad luck, the holiday is already on a weekend</span>
assert<span class="token punctuation">.</span><span class="token function">deepEqual</span><span class="token punctuation">(</span>
  <span class="token function">bridgePublicHolidays</span><span class="token punctuation">(</span>labourDay<span class="token punctuation">,</span> <span class="token number">2021</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=></span> d<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>    <footer>
      <p>
        This page includes a script which loads an implementation of Temporal in your browser.
        You can open a console in your browser's developer tools and try it out directly!
      </p>
      <p>View this or help contribute on <a href="https://github.com/tc39/proposal-temporal">GitHub</a>.</p>
    </footer>
  </body>
</html>
