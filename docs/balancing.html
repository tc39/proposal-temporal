<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Temporal documentation</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/kognise/water.css@latest/dist/light.min.css">
    <script type="application/javascript" src="./playground.js"></script>
    <link rel="stylesheet" type="text/css" href="./prism.css">
    <script>
      Temporal = { ...temporal.Temporal };
      Object.assign(Intl, temporal.Intl);

      // Customize output of Temporal objects for Chrome DevTools
      if (!window.devtoolsFormatters)
        window.devtoolsFormatters = [];
      window.devtoolsFormatters.push({
        header(x) {
          for (const type of [
            Temporal.Instant,
            Temporal.Calendar,
            Temporal.PlainDate,
            Temporal.PlainDateTime,
            Temporal.Duration,
            Temporal.PlainMonthDay,
            Temporal.PlainTime,
            Temporal.TimeZone,
            Temporal.PlainYearMonth
          ]) {
            if (x instanceof type) return ['span', {}, `${x[Symbol.toStringTag]} <${x}>`];
          }
          return null;
        },
        hasBody(x) {
          return x instanceof Temporal.Duration;
        },
        body(x) {
          const out = ['ol', { style: 'list-style-type: none;' }];
          for (const prop of [
            'years',
            'months',
            'weeks',
            'days',
            'hours',
            'minutes',
            'seconds',
            'milliseconds',
            'microseconds',
            'nanoseconds'
          ]) {
            if (x[prop] !== 0) out.push([
              'li',
              {},
              ['span', { style: 'color: purple;' }, prop],
              `: `,
              ['span', { style: 'color: blue;' }, x[prop]]
            ]);
          }
          return out;
        }
      });
    </script>
    <style>
      /* https://github.com/kognise/water.css/blob/master/src/variables-light.css */
      :root {
        --background: #efefef;
        --text-muted: #999999;
        --text-bright: #000000;
        --text-width: 900px;
        --variable: #39a33c;
      }
      body {
        font-size: 18px;
        max-width: var(--text-width);
        padding-top: 40px;  /* extra padding for banner */
        line-height: 1.5;
      }
      pre { border-left: 4px solid var(--variable); }
      code {
        padding: 1px 5px 2px 5px;
        line-height: 1.1;
        display: inline-block;
      }
      a code { color: inherit; }
      a code:hover { text-decoration: underline; }
      pre code { line-height: 1.4; }
      pre code[class*="language-"] { font-size: 0.85em; }
      pre[class*="language-"] { padding: 0.5em; }
      h1 { margin-top: 13px; }
      h2 { border-bottom: 2px solid var(--text-muted); margin-top: 2em; }
      h3 {
        border-bottom: 1px solid var(--text-muted);
        color: var(--text-muted);
        font-weight: normal;
      }
      h3 em { font-weight: bold; }
      h3 strong { color: var(--text-bright); }
      :not(h2) + h3 { margin-top: 2em; }
      footer {
        border-top: 1px solid var(--background);
        color: var(--text-muted);
        font-size: 0.8em;
        margin-top: 2em;
        padding-top: 10px;
      }
      .heading-link {
        left: calc((100vw - var(--text-width)) / 2 - 1.5em);
        opacity: 0;
        position: absolute;
        transition: opacity 150ms;
      }
      .heading-link:hover { text-decoration: none; }
      .heading-link::before { content: 'Â¶'; }
      h3:hover .heading-link { opacity: 1; }
      .banner {
        /* Gradient from https://joshnh.com/weblog/how-to-make-an-alert-bar/ */
        background-color: #fce94f;
        background-image: linear-gradient(135deg,
                                          transparent,
                                          transparent 25%,
                                          rgba(0, 0, 0, .05) 25%,
                                          rgba(0, 0, 0, .05) 50%,
                                          transparent 50%,
                                          transparent 75%,
                                          rgba(0, 0, 0, .05) 75%,
                                          rgba(0, 0, 0, .05));
        background-size: 20px 20px;
        box-shadow: 0 5px 0 rgba(0, 0, 0, .1);
        left: 0;
        padding: 0.4em 0;
        position: absolute;
        text-align: center;
        top: 0;
        width: 100%;
      }
    </style>
  </head>
  <body>
    <div class="banner">
      This proposal is <strong><a href="https://blogs.igalia.com/compilers/2020/06/23/dates-and-times-in-javascript/">experimental.</a></strong>
      It is being reviewed by TC39.
      <strong>Do</strong> try it out and <a href="https://github.com/tc39/proposal-temporal/issues">report bugs</a>; <strong>don't</strong> use it in production!
    </div>
<h1 id="duration-balancing">Duration Balancing</h1>
<p>With most types in Temporal, each unit has a natural maximum.
For example, there is no such time as 11:87, so when creating a <code>Temporal.PlainTime</code> from 11:87 the time is either clipped to 11:59 (&quot;constrain&quot; mode) or an exception is thrown (&quot;reject&quot; mode).</p>
<p>With <a href="./duration.html"><code>Temporal.Duration</code></a>, however, maximums are less clear-cut.
Take, for example, a duration of 100 seconds: <code>Temporal.Duration.from({ seconds: 100 })</code>.
100 seconds is equal to 1 minute and 40 seconds.
In some cases you may want to &quot;balance&quot; it, yielding 1 minute and 40 seconds.
In other cases you may want to keep it as an &quot;unbalanced&quot; duration of 100 seconds.</p>
<p>When a <code>Temporal.Duration</code> object is constructed from a string or a property bag object, no balancing is performed.</p>
<pre class="language-javascript"><code class="language-javascript">d <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Duration<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> seconds<span class="token operator">:</span> <span class="token number">100</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
d<span class="token punctuation">.</span>minutes<span class="token punctuation">;</span> <span class="token comment">// => 0</span>
d<span class="token punctuation">.</span>seconds<span class="token punctuation">;</span> <span class="token comment">// => 100</span>
d <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Duration<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'PT100S'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
d<span class="token punctuation">.</span>minutes<span class="token punctuation">;</span> <span class="token comment">// => 0</span>
d<span class="token punctuation">.</span>seconds<span class="token punctuation">;</span> <span class="token comment">// => 100</span></code></pre><p>The most common kind of unbalanced duration is a &quot;top-heavy&quot; duration where only the largest nonzero unit is unbalanced, e.g. <code>{ days: 45, hours: 10 }</code>.
Unbalanced durations that are not top-heavy, like <code>{ days: 4, hours: 60 }</code>, are rarely used.</p>
<h2 id="balancing-durations-with-round">Balancing Durations with <code>round()</code></h2>
<p><code>Temporal.Duration.prototype.round()</code>, in addition to rounding duration units at the low end, can also balance durations too.</p>
<p>By default, <code>round()</code> will not enlarge a top-heavy unbalanced duration.
By default, the largest unit in the input will be largest unit in the output.</p>
<pre class="language-javascript"><code class="language-javascript">d <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Duration<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> minutes<span class="token operator">:</span> <span class="token number">80</span><span class="token punctuation">,</span> seconds<span class="token operator">:</span> <span class="token number">30</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => PT80M30S</span>
d<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => PT80M30S (unchanged)</span></code></pre><p>However, <code>round()</code> will balance units smaller than the largest one.
This only matters in the rare case that an unbalanced duration isn&#39;t top-heavy.</p>
<pre class="language-javascript"><code class="language-javascript">d <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Duration<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> minutes<span class="token operator">:</span> <span class="token number">80</span><span class="token punctuation">,</span> seconds<span class="token operator">:</span> <span class="token number">90</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => PT80M90S</span>
d<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => PT81M30S (seconds balance to minutes, but not minutes=>hours)</span></code></pre><p>To fully balance a duration, use the <code>largestUnit</code> option:</p>
<pre class="language-javascript"><code class="language-javascript">d <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Duration<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> minutes<span class="token operator">:</span> <span class="token number">80</span><span class="token punctuation">,</span> seconds<span class="token operator">:</span> <span class="token number">90</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => PT80M90S</span>
d<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">{</span> largestUnit<span class="token operator">:</span> <span class="token string">'hours'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => PT1H21M30S (fully balanced)</span></code></pre><h2 id="balancing-relative-to-a-reference-point">Balancing Relative to a Reference Point</h2>
<p>Balancing that includes days, weeks, months, and years is more complicated because those units can be different lengths.
In the default ISO calendar, a year can be 365 or 366 days, and a month can be 28, 29, 30, or 31 days.
In other calendars, years aren&#39;t always 12 months long and weeks aren&#39;t always 7 days.
Finally, in time zones that use Daylight Saving Time (DST) days are not always 24 hours long.</p>
<p>Therefore, any <code>Duration</code> object with nonzero days, weeks, months, or years can refer to a different length of time depending on the specific date and time that it starts from.
To handle this potential ambiguity, the <code>relativeTo</code> option is used to provide a starting point.
<code>relativeTo</code> must be (or be parseable into) a <code>Temporal.ZonedDateTime</code> for timezone-specific durations or <code>Temporal.PlainDateTime</code> for timezone-neutral data.
<code>relativeTo</code> is required when balancing to or from weeks, months, or years.</p>
<pre class="language-javascript"><code class="language-javascript">d <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Duration<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> days<span class="token operator">:</span> <span class="token number">370</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => P370D</span>
d<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">{</span> largestUnit<span class="token operator">:</span> <span class="token string">'months'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => RangeError (`relativeTo` is required)</span>
d<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">{</span> largestUnit<span class="token operator">:</span> <span class="token string">'months'</span><span class="token punctuation">,</span> relativeTo<span class="token operator">:</span> <span class="token string">'2019-01-01'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => P1Y5D</span>
d<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">{</span> largestUnit<span class="token operator">:</span> <span class="token string">'months'</span><span class="token punctuation">,</span> relativeTo<span class="token operator">:</span> <span class="token string">'2020-01-01'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => P1Y4D (2020 is a leap year)</span></code></pre><p><code>relativeTo</code> is optional when balancing to or from <code>days</code>, and if <code>relativeTo</code> is omitted then days are assumed to be 24 hours long.
However, if the duration is timezone-specific, then it&#39;s recommended to use a <code>Temporal.ZonedDateTime</code> reference point to ensure that DST transitions are accounted for.</p>
<!-- prettier-ignore-start -->
<pre class="language-javascript"><code class="language-javascript">d <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Duration<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> hours<span class="token operator">:</span> <span class="token number">48</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => PT48H</span>
d<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">{</span> largestUnit<span class="token operator">:</span> <span class="token string">'days'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// => P2D</span>
d<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">{</span> largestUnit<span class="token operator">:</span> <span class="token string">'days'</span><span class="token punctuation">,</span> relativeTo<span class="token operator">:</span> <span class="token string">'2020-03-08T00:00-08:00[America/Los_Angeles]'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// => P2D1H (because one clock hour was skipped by DST starting)</span></code></pre><!-- prettier-ignore-end -->

<h2 id="balancing-in-duration-arithmetic">Balancing in Duration Arithmetic</h2>
<p>In addition to <code>round()</code> as described above, <code>add()</code> and <code>subtract()</code> also balance their output into either a fully-balanced or a top-heavy duration depending on the <code>largestUnit</code> option.</p>
<p>By default, <code>add()</code> and <code>subtract()</code> on <code>Temporal.Duration</code> instances will only balance up to the largest unit in either input duration.</p>
<pre class="language-javascript"><code class="language-javascript">d1 <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Duration<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> hours<span class="token operator">:</span> <span class="token number">26</span><span class="token punctuation">,</span> minutes<span class="token operator">:</span> <span class="token number">45</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => PT26H45M</span>
d2 <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Duration<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> minutes<span class="token operator">:</span> <span class="token number">30</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => PT30M</span>
d1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>d2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => PT27H15M</span></code></pre><p>The <code>largestUnit</code> option can be used to balance to larger units than the inputs.</p>
<pre class="language-javascript"><code class="language-javascript">d1 <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Duration<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> minutes<span class="token operator">:</span> <span class="token number">80</span><span class="token punctuation">,</span> seconds<span class="token operator">:</span> <span class="token number">90</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => PT80M90S</span>
d2 <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Duration<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> minutes<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span> seconds<span class="token operator">:</span> <span class="token number">15</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => PT100M15S</span>
d1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>d2<span class="token punctuation">,</span> <span class="token punctuation">{</span> largestUnit<span class="token operator">:</span> <span class="token string">'hours'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => PT3H1M45S (fully balanced)</span></code></pre><p>The <code>relativeTo</code> option can be used to balance to, or from, weeks, months or years (or days for timezone-aware durations).
<code>relativeTo</code> is interpreted relative to <code>this</code>, not to <code>other</code>, which allows the same <code>relativeTo</code> value to be used for a chain of arithmetic operations.</p>
<!-- prettier-ignore-start -->
<pre class="language-javascript"><code class="language-javascript">d1 <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Duration<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> hours<span class="token operator">:</span> <span class="token number">48</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => PT48H</span>
d2 <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Duration<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> hours<span class="token operator">:</span> <span class="token number">24</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => PT24H</span>
d1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>d2<span class="token punctuation">,</span> <span class="token punctuation">{</span> largestUnit<span class="token operator">:</span> <span class="token string">'days'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// => P3D</span>
d1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>d2<span class="token punctuation">,</span> <span class="token punctuation">{</span> largestUnit<span class="token operator">:</span> <span class="token string">'days'</span><span class="token punctuation">,</span> relativeTo<span class="token operator">:</span> <span class="token string">'2020-03-08T00:00-08:00[America/Los_Angeles]'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// => P3D1H (because one clock hour was skipped by DST starting)</span></code></pre><!-- prettier-ignore-end -->

<h2 id="serialization-of-fractional-seconds">Serialization of Fractional Seconds</h2>
<p>Normally, any Temporal object can be serialized to a string with its <code>toString()</code> method, and deserialized by calling <code>from()</code> on the string.
This goes for <code>Temporal.Duration</code> as well.
However, if any of the <code>milliseconds</code>, <code>microseconds</code>, or <code>nanoseconds</code> properties are greater than 999, then <code>Temporal.Duration.from(duration.toString())</code> will not yield an identical <code>Temporal.Duration</code> object.
The deserialized object will represent an equally long duration, but the sub-second fields will be balanced with the <code>seconds</code> field so that they become 999 or less.
For example, 1000 nanoseconds will become 1 microsecond.</p>
<p>This is because the ISO 8601 string format for durations, which is used for serialization for reasons of interoperability, does not allow for specifying sub-second units separately, only as a decimal fraction of seconds.
If you need to serialize a <code>Temporal.Duration</code> into a string that preserves unbalanced sub-second fields, you will need to use a custom serialization format or serialize it into an object or JSON instead.</p>
    <footer>
      <p>
        This page includes a script which loads an implementation of Temporal in your browser.
        You can open a console in your browser's developer tools and try it out directly!
      </p>
      <p>View this or help contribute on <a href="https://github.com/tc39/proposal-temporal">GitHub</a>.</p>
    </footer>
  </body>
</html>
